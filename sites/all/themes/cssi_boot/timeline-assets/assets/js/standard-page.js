
var TLConfigText={};TLConfigText['basic_am']="am";TLConfigText['basic_pm']="pm";TLConfigText['basic_Noon']="Noon";TLConfigText['basic_By']="By";TLConfigText['basic_weekDays']=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];TLConfigText['basic_shortWeekDays']=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];TLConfigText['basic_months']=["January","February","March","April","May","June","July","August","September","October","November","December"]
TLConfigText['basic_shortMonths']=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];TLConfigText['basic_daySuffixes']=["st","nd","rd","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","st","nd","rd","th","th","th","th","th","th","th","st","nd","rd","th","th","th","th","th","th","th"];TLConfigText['verifier_invaldiDate_message']="Not a valid date";TLConfigText['category_defaultTitle']="Event";TLConfigText['storyDefault_headline']="New story 1";TLConfigText['storyDefault_intro']="Enter story info here";TLConfigText['contentPanel_Read_more_text']="Find out more";TLConfigText['contentPanel_Play_video']="Play video";TLConfigText['contentPanel_Play_audio']="Play audio";TLConfigText['contentPanel_View_on']="View on";TLConfigText['contentPanel_Close_video']="Close video";TLConfigText['contentPanel_Close_audio']="Close audio";TLConfigText['flickrImageSelector_title']="Image finder";TLConfigText['flickrImageSelector_intro']='If you don\'t have your own webserver, you can use Flickr for your images. Sign up for a Flickr account <a href="http://www.flickr.com">here</a>. Flickr allows 30 images per timeline. You can add a further <span id="tl-flickr-image-limiter">x1</span> Flickr images to this timeline.';TLConfigText['flickrImageSelector_option1Title']="Find images by search term";TLConfigText['flickrImageSelector_option1Text']="Choose this option if you want to use images created by others under the Creative Commons license."
TLConfigText['flickrImageSelector_option1Label']="Enter search term";TLConfigText['flickrImageSelector_option1Message']="Images filtered by";TLConfigText['flickrImageSelector_option2Title']="Find my images";TLConfigText['flickrImageSelector_option2Text']="Choose this option to find images you have uploaded to Flickr.";TLConfigText['flickrImageSelector_option2Label']="Enter Flickr username";TLConfigText['flickrImageSelector_option2Message']="Images filtered by user";TLConfigText['flickrImageSelector_Photo_credit']="Photo credit";TLConfigText['flickrImageSelector_Expand']="Expand";TLConfigText['signup_Enter_class_code']="Enter class code";TLConfigText['signup_Username_exists']="Username already taken. Try another";TLConfigText['signup_Email_taken']="Email already used. Try another";TLConfigText['signup_Class_accounts_full']="Class accounts full. Speak to teacher";TLConfigText['signup_Incorrect_class_code']="Incorrect class code";TLConfigText['loginPopdown_incorrectLogin_message']="Incorrect login. Please try again";TLConfigText['loginPopdown_Email_not_in_database']="Email not in database";TLConfigText['groupEditLogin_logout_message']="You're already logged in. Log out first.";TLConfigText['groupEditLogin_loginError_message']="Incorrect secret code. Please try again";TLConfigText['marker_media_Enter_meda_source_here']="Enter media source here";TLConfigText['marker_moreButton_text']="More";TLConfigText['imageUploader_title']="Upload image";TLConfigText['imageUploader_intro']='Choose an image from your hard drive. Your account gives you <span id="tl-image-uploader-limit">x1</span> uploaded images per timeline. You can add <span id="tl-image-uploader-remaining">x1</span> more uploaded images to this timeline. Only upload images you have permission to use.';TLConfigText['imageURLSelect_title']="Image url";TLConfigText['imageURLSelect_intro']='Enter the url of an image on the web and click the \'Select\' button. This is the best option if you want to eventually host the timeline on your own webserver as part of our Single Timeline License.';TLConfigText['3d_click_to_find_out_more']="Click to find out more";var TLHashController=function(){var self=this;self.lastHash="";self.timeout="";self.timeoutTime=200;}
TLHashController.prototype={init:function(){var self=this;theTLSettings.registerAsObserver({observer:self,type:"currentDate"});self.lastHash=window.location.hash;self.lastHash=self.lastHash.replace("#","");self.initiateHashCheck();return self;},setHashToCurrentDate:function(){var self=this;self.currentDateWasUpdatedTo({date:AJKHelpers.cloneDate({date:theTLSettings.currentDate})});},setHashToStoryPanel:function(data){var self=this;if(theTLMainController.timeline.urlHashing==1){return;}
var storyId=data.storyId;self.lastHash="vars!panel="+storyId+"!";window.location.hash=self.lastHash;},currentDateWasUpdatedTo:function(data){var self=this;var aDate=data.date;var extraInfo=data.extraInfo;if(extraInfo&&(extraInfo.drag||!extraInfo.updateHash)||theTLMainController.timeline.urlHashing==1){return;}
self.lastHash=AJKHelpers.formatDate({date:aDate,formatString:"YYYY-MM-DD_HH:mm:ss",forceFullDate:true,language:"base"});self.lastHash="vars!date="+self.lastHash+"!";window.location.hash=self.lastHash;},initiateHashCheck:function(){var self=this;self.timeout=setTimeout(function(){var newHash=window.location.hash;newHash=newHash.replace("#","");if(newHash!=self.lastHash){self.lastHash=newHash;self.translateHash({hash:newHash});}
var thisFunc=arguments.callee;self.timeout=setTimeout(function(){thisFunc();},self.timeoutTime);},self.timeoutTime);},translateHash:function(data){var self=this;var storyId=self.getHashPanel({hash:data.hash});if(storyId){theTLMainController.displayPanelForStoryId({id:storyId});}
else{var aDate=self.getHashDate({hash:data.hash});if(aDate){theTLSettings.setCurrentDate({date:aDate});theTLMainController.hideContentPanelIfVisible();}}},getHashDate:function(data){var self=this;var aHash=data.hash;aHash=aHash.replace("vars!","!");var splitHash=aHash.split("!");var aDate=false;if(splitHash&&splitHash[1]){var info=splitHash[1];if(info.indexOf("date=")!=-1){var dateTxt=info.split("date=")[1];if(dateTxt){dateTxt=dateTxt.replace("_"," ");aDate=AJKHelpers.dateFromMySQLDate({dateString:dateTxt});}}}
return aDate;},getHashPanel:function(data){var self=this;var aHash=data.hash;aHash=aHash.replace("vars!","!");var splitHash=aHash.split("!");var storyId=false;if(splitHash&&splitHash[1]){var info=splitHash[1];if(info.indexOf("panel=")!=-1){var panelTxt=info.split("panel=")[1];if(panelTxt){storyId=panelTxt;}}}
return storyId;}}
var TLSettings=function(){var self=this;self.observers=new Array();self.currentDate=new Date();self.visibleStartDate="";self.visibleEndDate="";self.visibleDateRange="";self.windowSize=AJKHelpers.viewportSize();self.animateTime=1000;self.onlyMouseScrollIfAlone=true;self.lastSelectedStory="";self.flickrApiKey="1eed7e0b716c8554acfe67108c57952e";self.flickrReplacementImage="/assets/ui/flickr-r2.gif";}
TLSettings.prototype={sliderDraggerMinWidth:36,init:function(){var self=this;theAJKWindowResizeEvent.registerAsObserver({observer:self});theAJKMouseScrollEvent.registerAsObserver({observer:self});return self;},limitDateToRange:function(data){var self=this;var aDate=data.aDate;aDate=(aDate.getTime()<self.visibleStartDate.getTime())?self.visibleStartDate:aDate;aDate=(aDate.getTime()>self.visibleEndDate.getTime())?self.visibleEndDate:aDate;return aDate;},mouseDidScroll:function(data){var self=this;var delta=-data.delta;var dateRange=self.visibleEndDate.getTime()-self.visibleStartDate.getTime();var change=Math.round(delta/50*dateRange/2);var newDate=new Date();newDate.setTime(self.currentDate.getTime()+change);newDate=self.limitDateToRange({aDate:newDate});if($.browser.msie){setTimeout(function(){self.setCurrentDate({date:newDate,extraInfo:{updateHash:false}});},50);}
else{if(!self.testTimeout){self.testTimeout=setTimeout(function(){self.setCurrentDate({date:newDate,extraInfo:{updateHash:false,viewOnlySpeed:1}});self.testTimeout="";},1);}}
self.lastSelectedStory="";},windowDidResize:function(data){var self=this;self.windowSize=data.newSize;},setCurrentDate:function(data){var self=this;var date=data.date;var extraInfo=data.extraInfo;var animate=data.animate;var callback=data.callback;var instantly=data.instantly;var speed=(data.speed)?data.speed:self.animateTime;if(animate&&!instantly){$({date:self.currentDate.getTime()}).animate({date:date.getTime()},{duration:speed,step:function(){var aDate=new Date();aDate.setTime(this.date);self.currentDate=AJKHelpers.cloneDate({date:aDate});self.informObservers({extraInfo:extraInfo});},complete:function(){var aDate=new Date();aDate.setTime(this.date);self.currentDate=AJKHelpers.cloneDate({date:aDate});self.informObservers({extraInfo:extraInfo});if(callback){callback();}}});}
else{self.currentDate=AJKHelpers.cloneDate({date:date});self.informObservers({extraInfo:extraInfo});}},informObservers:function(data){var self=this;var extraInfo=data.extraInfo;if(self.observers["currentDate"]){$.each(self.observers["currentDate"],function(){if(this.currentDateWasUpdatedTo){this.currentDateWasUpdatedTo({date:self.currentDate,extraInfo:extraInfo});}});}},ensureCurrentDateIsWithinVisibleRange:function(){var self=this;self.currentDate=self.limitDateToRange({aDate:self.currentDate});},timeInfo:{start:"",end:"",msecs:"",secs:"",mins:"",hours:"",days:"",months:"",years:"",decades:""},registerAsObserver:function(data){var self=this;var type=data.type;var observer=data.observer;if(!self.observers[type]){self.observers[type]=new Array();}
self.observers[type]=AJKHelpers.removeItemFromArray({anArray:self.observers[type],item:observer})
self.observers[type].push(observer);},removeAsObserver:function(data){var self=this;var type=data.type;var observer=data.observer;if(self.observers[type]){self.observers[type]=AJKHelpers.removeItemFromArray({anArray:self.observers[type],item:observer});}}}
try{document.execCommand("BackgroundImageCache",false,true);}catch(err){}
if(!Array.prototype.indexOf){Array.prototype.indexOf=function(value,start){var arrayLength=this.length;var start=(!start)?0:start;for(var i=start;i<arrayLength;i++){if(this[i]==value){return i;}}
return-1;}}
Date.parseOrig=Date.parse;Date.parse=function(input){if(typeof input==="string"){input=input.replace("ad","").replace("AD","");var isBC=(input.toLowerCase().indexOf("bc")!=-1);input=input.replace("bc","").replace("BC","");var largeYear=Date.AJKIsStringLargeYear(input);if(largeYear){var retDate=new Date();if(isBC){retDate.setFullYear(-largeYear);}
else{retDate.setFullYear(largeYear);}
return retDate;}
else if(isBC){var aDate=Date.parseOrig(input);if(!aDate){return aDate;}
aDate.setFullYear(-aDate.getFullYear());return aDate;}
else{return Date.parseOrig(input);}}
else{return Date.parseOrig(input);}}
Date.STANDARDMAXFULLYEAR=99999;Date.MAXFULLYEAR=999999999999;Date.AJKLongDateActive=true;Date.AJKIsStringLargeYear=function(input){input=input.replace(/ /g,"").replace(/,/g,"");if(parseInt(input,10)==input&&input>Date.STANDARDMAXFULLYEAR&&input<Date.MAXFULLYEAR){return input;}
return false;}
Date.prototype.origSetFullYear=Date.prototype.setFullYear;Date.prototype.setFullYear=function(fullYear){if(fullYear>Date.STANDARDMAXFULLYEAR||fullYear<-Date.STANDARDMAXFULLYEAR){this.setFullYear(0);this.ajkLongDate=true;this.ajkLongDateYear=fullYear;}
else{this.ajkLongDate=false;return this.origSetFullYear(fullYear);}}
Date.prototype.origGetFullYear=Date.prototype.getFullYear;Date.prototype.getFullYear=function(fullYear){return(this.ajkLongDate)?this.ajkLongDateYear:this.origGetFullYear();}
Date.prototype.origGetTime=Date.prototype.getTime;Date.prototype.getTime=function(data){if(!Date.AJKLongDateActive){return this.origGetTime(data);}
else{return(this.ajkLongDate)?(this.ajkLongDateYear-1970)*AJKHelpers.dateOneYearInMS:this.origGetTime();}}
Date.prototype.origSetTime=Date.prototype.setTime;Date.prototype.setTime=function(data){if(!Date.AJKLongDateActive){return this.origSetTime(data);}
else{var fullYear=data/AJKHelpers.dateOneYearInMS+1970;if(fullYear>Date.STANDARDMAXFULLYEAR||fullYear<-Date.STANDARDMAXFULLYEAR){this.ajkLongDate=true;this.ajkLongDateYear=fullYear;}
else{this.ajkLongDate=false;return this.origSetTime(data);}}}
var AJKHelpers={iDevice:-1,isIDevice:function(){if(this.iDevice==-1){this.iDevice=(navigator.platform.indexOf("iPhone")!=-1)||(navigator.platform.indexOf("iPod")!=-1)||(navigator.userAgent.match(/iPad/i)!=null);}
return this.iDevice;},emptyImage:"/assets/ui/empty-image.gif",cloudfront:"d8lktyzx0qqvd.cloudfront.net",uploadDomain:"tikitokiservices.com",getProcessedImageUrlForAccount:function(data){var imgSrc=data.imgSrc;var accountType=data.accountType;var forceShow=data.forceShow;if(imgSrc&&imgSrc.indexOf("tikitokiservices.com")!=-1){if(accountType=="Standard"&&!forceShow){return this.emptyImage;}
else{return imgSrc.replace("www."+this.uploadDomain,this.cloudfront).replace(this.uploadDomain,this.cloudfront);}}
else{return imgSrc;}},getTimelineImageUrl:function(data){var imageSrc=data.src;if(!imageSrc){return data.emptyImage||"/assets/ui/empty-image.gif";}
var emptyImage=(data.emptyImage)?data.emptyImage:theTLSettings.flickrReplacementImage;if(imageSrc.indexOf("flickr.com")!=-1){var altPath=theTLMainController.timeline.altFlickrImageUrl;if(altPath&&altPath.indexOf("http://")!=-1){var imageUrlSplit=imageSrc.split("/");var newImageSrc=altPath+imageUrlSplit[imageUrlSplit.length-1];return this.getProcessedImageUrlForAccount({imgSrc:newImageSrc,accountType:theTLMainController.timeline.accountType,forceShow:true});}
else{return emptyImage;}}
else{return this.getProcessedImageUrlForAccount({imgSrc:imageSrc,accountType:theTLMainController.timeline.accountType});}},isFlickrImage:function(data){return(data.src.indexOf("flickr.com")!=-1&&!theTLMainController.timeline.altFlickrImageUrl);},getFKRPhotoPageFromImageSrc:function(data){var imgSplit=data.src.split("/");var lastBit=imgSplit[imgSplit.length-1];if(lastBit){fkrId=lastBit.split("_")[0];return"http://flickr.com/photo.gne?id="+fkrId;}
return"http://flickr.com";},convertNumToXDecimalPlaces:function(data){var num=data.num;var cnvInt=Math.pow(10,data.x);return parseInt(num*cnvInt)/cnvInt;},stringRepeat:function(data){var aString=data.aString;var multiplier=data.multiplier;return new Array(multiplier+1).join(aString);},convertHexColourToRGB:function(data){var hexColour=data.hexColour;var cutHex=function(h){return(h.charAt(0)=="#")?h.substring(1,7):h}
var hexToR=function(h){return parseInt((cutHex(h)).substring(0,2),16)}
var hexToG=function(h){return parseInt((cutHex(h)).substring(2,4),16)}
var hexToB=function(h){return parseInt((cutHex(h)).substring(4,6),16)}
return{r:hexToR(hexColour),g:hexToG(hexColour),b:hexToB(hexColour)}},generateAudioEmbedHTML:function(data){var self=this;var audioSrc=data.src;var type=data.type;var audioId=data.audioId;var colour=data.colour;if(type=="dailymotion"||type=="youtube"||type=="vimeo"){data.videoId=data.audioId;return AJKHelpers.generateVideoEmbedHTML(data);}
else if(type=="soundcloud"){if($.browser.msie||$.browser.isModernIE){var iHTML='<object height="100%" width="100%" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000">';iHTML+='<param name="movie" value="http://player.soundcloud.com/player.swf?url='+audioSrc+'&auto_play=true&show_artwork=true&theme_color=000000&color='+colour+'"></param>';iHTML+='<param name="allowscriptaccess" value="always"></param>';iHTML+='<embed allowscriptaccess="always" height="100%" src="http://player.soundcloud.com/player.swf?url='+audioSrc+'&auto_play=true&show_artwork=true&theme_color=000000&color='+colour+'&visual=true" type="application/x-shockwave-flash" width="100%"></embed>';iHTML+='</object>';}
else{var iHTML='<iframe width="100%" height="100%" scrolling="no" frameborder="no" src="http://w.soundcloud.com/player/?url='+audioSrc+'&auto_play=true&show_artwork=true&theme_color=000000&color='+colour+'&visual=true"></iframe>';}
return iHTML;}
else if(type=="skoletube"){audioSrc="http://www.skoletube.dk/flvideo/"+AJKHelpers.decode_base64(audioId)+".mp3";}
var insertHTML=AJKHelpers.generateStandardVideoPlayerEmbedHTML({audioUrl:audioSrc,colour:colour});return insertHTML;},generateVideoEmbedHTML:function(data){var self=this;var vidSrc=data.src;var type=data.type;type=(type)?type:"file";var width=data.width;var height=data.height;var videoId=data.videoId;var colour=data.colour;var theme=(data.theme)?data.theme:"dark";var protocal=(document.location.protocol=='https:')?"https:":"http:";var autoplay=(data.autoplay)?1:0;var insertHTML="";switch(type){case"vimeo":insertHTML='<iframe src="'+protocal+'//player.vimeo.com/video/'+videoId+'?color='+colour+'&autoplay=1&title=0&portrait=0&byline=0" width="'+width+'" height="'+height+'" frameborder="0"></iframe>';break;case"youtube":if($.browser.msie&&$.browser.version<9){insertHTML='<embed src="http://www.youtube.com/v/'+videoId+'" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="'+width+'" height="'+height+'"></embed>';}
else{insertHTML+='<iframe class="youtube-player" type="text/html" width="'+width+'" height="'+height+'" src="'+protocal+'//www.youtube.com/embed/'+videoId+'?theme='+theme+'" frameborder="0"></iframe>';}
break;case"dailymotion":insertHTML+='<iframe src="'+protocal+'//www.dailymotion.com/embed/video/'+videoId+'" width="'+width+'" height="'+height+'" frameborder="0"></iframe>';break;case"skoletube":var vidUrl="http://www.skoletube.dk/flvideo/"+AJKHelpers.decode_base64(videoId)+".mp4";data.videoUrl=vidUrl;insertHTML+=AJKHelpers.generateStandardVideoPlayerEmbedHTML(data);break;case"ina.fr":insertHTML+='<div style="width: 600px; margin: 0 auto 0 auto; overflow: hidden; height: 100%;"><iframe width="600" height="350" frameborder="0" marginheight ="0" marginwidth="0" scrolling="no" src="'+videoId+'"></iframe></div>';break;case"discovery.snag":insertHTML+='<div style="width: 550px; margin: 0 auto 0 auto; overflow: hidden; height: 100%;"><iframe width="550" height="350" src="'+vidSrc+'" frameborder="0" scrolling="no" allowtransparency="true"></iframe></div>';break;case"iframe":insertHTML+='<iframe width="'+width+'" height="'+height+'" src="'+vidSrc+'" frameborder="0" scrolling="no" allowtransparency="true"></iframe>';break;case"file":data.videoUrl=vidSrc;insertHTML=AJKHelpers.generateStandardVideoPlayerEmbedHTML(data);break;}
insertHTML=(insertHTML)?insertHTML:'<div></div>';return insertHTML;},generateStandardVideoPlayerEmbedHTML:function(data){var vidUrl=data.videoUrl;var audioUrl=data.audioUrl;var mediaUrl=(vidUrl)?vidUrl:audioUrl;var mediaType=(vidUrl)?"video":"audio";var colour=data.colour;var insertHTML="";var theme=theTLMainController.timeline.lightboxStyle;var backColor=(theme==1)?"FFFFFF":"000000";var controlColor=(theme==1)?"333333":"FFFFFF";if(this.isIDevice()){if(mediaType=="audio"){insertHTML+='<audio style="display: block; width: 100%; height: 100%" src="'+audioUrl+'" controls autoplay height="100%" width="100%"></audio>';}
else{insertHTML+='<video src="'+vidUrl+'" controls autoplay height="100%" width="100%"></video>';}}
else if($.browser.msie&&$.browser.version<9){insertHTML+='<embed type="application/x-shockwave-flash" width="100%" height="100%" src="/assets/jaris-player/player.swf?1.002" allowfullscreen="true" bgcolor="#'+backColor+'" flashvars="source='+mediaUrl+'&streamtype=file&type='+mediaType+'&autostart=true&darkcolor='+backColor+'&brightcolor='+backColor+'&controlcolor='+controlColor+'&hovercolor=67A8C1&controltype=1">';}
else{insertHTML+='<object id="player" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" name="player" width="100%" height="100%">';insertHTML+='<param name="movie" value="/assets/jaris-player/player.swf?1.002" />';insertHTML+='<param name="allowfullscreen" value="true" />';insertHTML+='<param name="bgcolor" value="#'+backColor+'" />';insertHTML+='<param name="flashvars" value="source='+mediaUrl+'&streamtype=file&type='+mediaType+'&duration=52&darkcolor='+backColor+'&brightcolor='+backColor+'&controlcolor='+controlColor+'&hovercolor=67A8C1&controltype=1" />';insertHTML+='<embed type="application/x-shockwave-flash" width="100%" height="100%" src="/assets/jaris-player/player.swf?1.002" allowfullscreen="true" bgcolor="#'+backColor+'" flashvars="source='+mediaUrl+'&streamtype=file&type='+mediaType+'&autostart=true&darkcolor='+backColor+'&brightcolor='+backColor+'&controlcolor='+controlColor+'&hovercolor=67A8C1&controltype=1">';insertHTML+='</object>';}
return insertHTML;},getImageSize:function(data){var imageUrl=data.imageUrl;var anImage=new Image();anImage.src=imageUrl;return{width:anImage.width,height:anImage.height}},sizeImageToFitInBoxOfSize:function(data){var domImage=data.domImage;var boxSize=data.boxSize;var imageSize=data.imageSize;var returnScaledImageSize=data.returnScaledImageSize;var imageOffset=data.imageOffset;var scaledUp=data.scaledUp||1;if($.browser.isChrome&&$.browser.isWindows&&$(domImage).height()<1&&!data.recursion&&!imageSize){var thisFunc=arguments.callee;data.recursion=true;setTimeout(function(){thisFunc(data);},0);return{};}
if(imageOffset&&typeof imageOffset.x=="undefined"){var newImageOffset={};var splitVal=imageOffset.split(",");newImageOffset.x=(splitVal[0])?parseFloat(splitVal[0]):0;newImageOffset.y=(splitVal[1])?parseFloat(splitVal[1]):0;imageOffset=newImageOffset;}
if(!imageSize){imageSize={width:$(domImage).width(),height:$(domImage).height()}}
var adjustedDimensions={height:0,width:0,xOffset:0,yOffset:0}
if(imageSize.width/imageSize.height>boxSize.width/boxSize.height){adjustedDimensions.height=boxSize.height;adjustedDimensions.width=Math.round(adjustedDimensions.height/imageSize.height*imageSize.width);adjustedDimensions.xOffset=-Math.round((adjustedDimensions.width-boxSize.width)/2);adjustedDimensions.yOffset=0;}
else{adjustedDimensions.width=boxSize.width;adjustedDimensions.height=Math.round(adjustedDimensions.width/imageSize.width*imageSize.height);adjustedDimensions.yOffset=-Math.round((adjustedDimensions.height-boxSize.height)/2);adjustedDimensions.xOffset=0;}
var adjustedAgainDimensions={yOffset:adjustedDimensions.yOffset-(((adjustedDimensions.height*scaledUp)-adjustedDimensions.height)/2),xOffset:adjustedDimensions.xOffset-(((adjustedDimensions.width*scaledUp)-adjustedDimensions.width)/2),width:adjustedDimensions.width*scaledUp,height:adjustedDimensions.height*scaledUp}
if(imageOffset){var possXOffset=adjustedAgainDimensions.width-boxSize.width;adjustedAgainDimensions.xOffset=Math.round(-possXOffset/2+possXOffset/2*-imageOffset.x);var possYOffset=adjustedAgainDimensions.height-boxSize.height;adjustedAgainDimensions.yOffset=Math.round(-possYOffset/2+possYOffset/2*-imageOffset.y);}
if(domImage){$(domImage).css({width:adjustedAgainDimensions.width+"px",height:adjustedAgainDimensions.height+"px",left:adjustedAgainDimensions.xOffset+"px",top:adjustedAgainDimensions.yOffset+"px"});}
if(returnScaledImageSize){return adjustedDimensions;}},renderCanvasText:function(data){var ctx=data.canvasContext;var x=data.textPos.x;var y=data.textPos.y;var maxWidth=data.maxWidth;var maxLines=(data.maxLines)?data.maxLines:5000;var lineHeight=data.lineHeight;var text=data.text;var retLines="";var words=text.split(' ');var numWords=words.length;var lines=data.lines;if(lines){$.each(lines,function(){ctx.fillText(this,x,y);y+=lineHeight;});}
else{var line='';retLines=[];for(var n=0;n<numWords;n++){var testLine=line+words[n]+' ';var metrics=ctx.measureText(testLine);var testWidth=metrics.width;if(testWidth>maxWidth&&retLines.length<maxLines){var cachedLine=line;retLines.push(cachedLine);ctx.fillText(line,x,y);line=words[n]+' ';y+=lineHeight;}
else{line=testLine;}}
if(retLines.length<maxLines){retLines.push(line);ctx.fillText(line,x,y);}}
return retLines||lines;},customCreateClickableLinks:function(data){var aString=data.aString;var extra=(data.extra)?data.extra:"";var myRegex=/\[(.*)\]\((.*)\)/gim
return aString.replace(myRegex,function(){extra=(AJKHelpers.isUrlToCurrentPage({url:RegExp.$2}))?"":extra;return'<a '+extra+' href="'+RegExp.$2+'">'+RegExp.$1.replace(/-/g," ")+'</a>'});},isUrlToCurrentPage:function(data){var aUrl=data.url;aUrl=aUrl.split("#")[0];if(aUrl=="./"){return true;}
var cUrl=window.location.href.toString();cUrl=cUrl.split("#")[0];return(cUrl==aUrl);},createClickableLinks:function(data){var aString=data.aString;return aString.replace(/(ftp|http|https|file):\/\/[\S]+(\b|$)/gim,'<a href="$&">$&</a>').replace(/([^\/])(www[\S]+(\b|$))/gim,'$1<a href="http://$2">$2</a>');},getMousePos:function(data){var event=data.event;xPos=yPos=false;if(document.layers){xPos=event.x;yPos=event.y;}
else if(document.all){xPos=window.event.clientX;yPos=window.event.clientY;}
else if(document.getElementById){xPos=event.clientX;yPos=event.clientY;}
return{x:xPos,y:yPos};},getSelfOrFirstParantOfClass:function(data){var currentDomEl=data.domEl;var className=data.className;while(currentDomEl){if($(currentDomEl).hasClass(className)){return currentDomEl;}
currentDomEl=$(currentDomEl).parent()[0];}
return false;},generateRandomDate:function(data){var startDate=data.startDate;var endDate=data.endDate;var diff=endDate.getTime()-startDate.getTime();var randNum=Math.floor(Math.random()*diff);var retDate=new Date();retDate.setTime(startDate.getTime()+randNum);return retDate;},getEmptyDate:function(){var date=new Date();date.setTime(0);return date;},cloneDate:function(data){var retDate=new Date();retDate.setTime(data.date.getTime());return retDate;},createDateWithTime:function(data){var retDate=new Date();retDate.setTime(data.time);return retDate;},getFirstDayOfYearDateForDate:function(data){var aDate=this.createDateWithTime({time:data.date.getTime()});aDate.setDate(1);aDate.setMonth(0);aDate.setHours(0);aDate.setMinutes(0);aDate.setSeconds(0);aDate.setMilliseconds(0);return aDate;},getFirstDayOfMonthDateForDate:function(data){var aDate=this.createDateWithTime({time:data.date.getTime()});aDate.setDate(1);aDate.setHours(0);aDate.setMinutes(0);aDate.setSeconds(0);aDate.setMilliseconds(0);return aDate;},numberOfDaysInMonth:function(data){var aDate=data.aDate;var year=aDate.getFullYear();var month=aDate.getMonth();var tmpStartDate=this.getEmptyDate();tmpStartDate.setFullYear(year);tmpStartDate.setMonth(month);tmpStartDate.setDate(1);var nextMonth=(month==11)?0:month+1;var nextYear=(month==11)?year+1:year;var tmpEndDate=this.getEmptyDate();tmpEndDate.setFullYear(nextYear);tmpEndDate.setMonth(nextMonth);tmpEndDate.setDate(1);var numDays=Math.round((tmpEndDate.getTime()-tmpStartDate.getTime())/this.dateOneDayInMS);return numDays;},waitForId:function(data){var anObject=data.anObject;var callback=data.callback;var checkForId=function(){if(anObject.id=="awaiting"){var thisFunc=arguments.callee;setTimeout(function(){thisFunc();},100);}
else if(callback){callback();}}
checkForId();},cloneObj:function(data){var obj=data.obj
if(obj==null||typeof(obj)!='object'){return obj;}
var temp=new obj.constructor();for(var key in obj){temp[key]=this.cloneObj({obj:obj[key]});}
return temp;},jiggleDomEl:function(data){var domEl=data.domEl;var displacementFactor=data.displacementFactor;var leftOffset=($(domEl).css("left")&&$(domEl).css("left")!="auto")?parseInt($(domEl).css("left")):0;var position=$(domEl).css("position");if(position!="absolute"){$(domEl).css({position:"relative"});}
var numRadians=16;var steps=25;for(var counter=0;counter<=numRadians;counter+=0.2){(function(){var lOffset=leftOffset+Math.cos(counter)*displacementFactor;var delay=parseInt(counter*steps);setTimeout(function(){$(domEl).css({left:lOffset});if(Math.abs(delay-(numRadians*steps))<5){$(domEl).css({position:position,left:leftOffset});}},delay);}());}},flashDomEl:function(data){var domEl=data.domEl;var numRadians=(data.numRadians)?data.numRadians:12;var steps=50;for(var counter=0;counter<=numRadians;counter+=0.2){(function(){var opacity=Math.cos(counter);var delay=parseInt(counter*steps);setTimeout(function(){$(domEl).css({opacity:0.3+0.7*opacity});if(Math.abs(delay-(numRadians*steps))<5){$(domEl).css({opacity:1});}},delay);}());}},isEmail:function(data){var self=this;var aString=data.aString;return aString.match(/^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i);},cancelSelectionOnDomEl:function(data){var domEl=data.domEl;domEl.onselectstart=function(){return false;};domEl.unselectable="on";domEl.style.MozUserSelect="none";},getCoordsOfDomEl:function(data){var domEl=data.domEl;var xPos=yPos=0;if(domEl.offsetParent){xPos=domEl.offsetLeft;yPos=domEl.offsetTop;while(domEl=domEl.offsetParent){xPos+=domEl.offsetLeft;yPos+=domEl.offsetTop;}}
return{x:xPos,y:yPos};},get4CoordsOfDomEl:function(data){var domEl=data.domEl;var coords=this.getCoordsOfDomEl(data);coords.x2=coords.x+$(domEl).width();coords.y2=coords.y+$(domEl).height();return coords;},calculateDomElHeight:function(data){var self;var domEl=data.domEl;var height=$(domEl).height()
height+=parseInt($(domEl).css("marginTop"));height+parseInt($(domEl).css("marginBottom"));return height;},getNowDate:function(){return new Date();},trimArray:function(data){var anArray=data.anArray;var limit=(anArray.length<data.limit)?anArray.length:data.limit;var counter=0;var retArray=new Array();while(counter<limit){retArray.push(anArray[counter++]);}
return retArray;},dateFromMySQLDate:function(data){var dateString=data.dateString;if(!dateString||dateString=="undefined"){return false;}
var isBC=(dateString.indexOf("BC")!=-1);dateString=dateString.replace(" BC","").replace("BC","");var containsMillion=(dateString.indexOf("million")!=-1);var containsBillion=(dateString.indexOf("billion")!=-1);if(containsMillion||containsBillion){splitString=(containsMillion)?dateString.split(" million"):dateString.split(" billion");var tYear=(containsMillion)?splitString[0]*1000000:splitString[0]*1000000000;dateString=parseInt(tYear)+splitString[1];}
var dateAllArray=dateString.split(" ");var dateArray=dateAllArray[0].split("-");var timeArray=dateAllArray[1].split(":");var date=this.getEmptyDate();date.setDate(parseInt(dateArray[2],10));date.setMonth(parseInt(dateArray[1],10)-1);var aYear=parseInt(dateArray[0],10);if(isBC){date.setFullYear(-aYear);}
else{date.setFullYear(aYear);}
date.setHours(parseInt(timeArray[0],10));date.setMinutes(parseInt(timeArray[1],10));date.setSeconds(parseInt(timeArray[2],10));return date;},dateMillion:"million",dateBillion:"billion",dateAD:"AD",dateBC:"BC",dateWeekDayArray:TLConfigText['basic_weekDays'],dateWeekDayShortArray:TLConfigText['basic_shortWeekDays'],dateMonthsArray:TLConfigText['basic_months'],dateMonthsShortArray:TLConfigText['basic_shortMonths'],dateDaySuffixArray:TLConfigText['basic_daySuffixes'],dateOneHourInMS:1000*60*60,dateOneDayInMS:1000*60*60*24,dateOneYearInMS:1000*60*60*24*365.2425,baseLangDateWeekDayArray:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],baseLangDateWeekDayShortArray:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],baseLangDateMonthsArray:["January","February","March","April","May","June","July","August","September","October","November","December"],baseLangDateMonthsShortArray:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],baseLangDateDaySuffixArray:["st","nd","rd","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","st","nd","rd","th","th","th","th","th","th","th","st","nd","rd","th","th","th","th","th","th","th"],baseLangBC:"BC",baseLangAD:"AD",prettyDateFromMySQLDate:function(data){var jsDate=this.dateFromMySQLDate({dateString:data.dateString});return this.prettyDateFromDate({date:jsDate});},formatDate:function(data){var date=data.date;var formatString=data.formatString;if(!formatString){return formatString;}
var prefix=(data.language&&data.language=="base")?"baseLangDate":"date";var forceFullDate=data.forceFullDate;var aYear=date.getFullYear();if((aYear>Date.STANDARDMAXFULLYEAR||aYear<-Date.STANDARDMAXFULLYEAR)&&data.language=="base"&&!forceFullDate){formatString="YYYY";}
var firstOpenBracket=formatString.indexOf("[");var firstCloseBracket=formatString.indexOf("]");var lastChar=formatString.length-1;if(firstOpenBracket!=-1&&firstCloseBracket!=-1&&firstCloseBracket>firstOpenBracket){var beforeText=(firstOpenBracket!=0)?formatString.slice(0,firstOpenBracket):"";var middleText=formatString.slice(firstOpenBracket+1,firstCloseBracket);var endText=((firstCloseBracket+1)>firstCloseBracket)?formatString.slice(firstCloseBracket+1):"";return this.formatDate({date:date,formatString:beforeText})+middleText+this.formatDate({date:date,formatString:endText});}
formatString=formatString.replace(/Summer/,"SuXXer");formatString=formatString.replace(/summer/,"suXXer");formatString=formatString.replace(/YYYY/g,AJKHelpers.formatFullYearForDate({date:date,language:data.language}));formatString=formatString.replace(/MMMM/g,this[prefix+"MonthsArray"][date.getMonth()]);formatString=formatString.replace(/MMM/g,this[prefix+"MonthsShortArray"][date.getMonth()]);formatString=formatString.replace(/MM/g,this.doubleDigitNum({num:date.getMonth()+1}));formatString=formatString.replace(/DD/g,this.doubleDigitNum({num:date.getDate()}));formatString=formatString.replace(/dd/g,date.getDate());formatString=formatString.replace(/nn/g,this[prefix+"DaySuffixArray"][date.getDate()-1]);formatString=formatString.replace(/HH/g,this.doubleDigitNum({num:date.getHours()}));formatString=formatString.replace(/hh/g,this.twelveHourHour({hour:date.getHours()}));formatString=formatString.replace(/mm/g,this.doubleDigitNum({num:date.getMinutes()}));formatString=formatString.replace(/ss/g,this.doubleDigitNum({num:date.getSeconds()}));formatString=formatString.replace(/WKD/g,this[prefix+"WeekDayArray"][date.getDay()]);formatString=formatString.replace(/wkd/g,this[prefix+"WeekDayShortArray"][date.getDay()]);formatString=formatString.replace(/AMPM/g,this.amOrPmForHour({hour:date.getHours()}));formatString=formatString.replace(/SuXXer/,"Summer");formatString=formatString.replace(/suXXer/,"summer");return formatString;},formatFullYearForDate:function(data){var date=data.date;var aYear=date.getFullYear();var yearString=AJKHelpers.quadrupleDigitNum({num:aYear});if(data.language=="base"){if(aYear<0){yearString+=" "+this.baseLangBC;}}
else{if(yearString>9999){yearString=this.prettifyYearString({year:yearString});}
yearString=(aYear<0)?((this.dateBC)?yearString+" "+this.dateBC:"-"+yearString):yearString;}
return yearString;},prettifyYearString:function(data){var retStr="",aYear=data.year;if(this.dateMillion&&this.dateBillion){if(aYear>999999999){retStr=aYear/1000000000;retStr=Math.round(retStr*100)/100;retStr=retStr.toString()+" "+this.dateBillion;}
else if(aYear>999999){retStr=aYear/1000000;retStr=Math.round(retStr*100)/100;retStr=retStr.toString()+" "+this.dateMillion;}
else{retStr=aYear;}}
else{retStr=aYear;}
return retStr;},prettyDateFromDate:function(data){var jsDate=data.date;var smallDate=data.smallDate;var fullMonth=data.fullMonth;var monthStringArray=(fullMonth)?this.dateMonthsArray:this.dateMonthsShortArray;var x=jsDate.getYear();var y=x%100;y+=(y<38)?2000:1900;var year=y;if(smallDate){return jsDate.getDate()+"/"+(jsDate.getMonth()+1)+"/"+year.toString().substring(2,4);}
else{return jsDate.getDate()+this.dateDaySuffixArray[jsDate.getDate()-1]+" "+monthStringArray[jsDate.getMonth()]+" "+year;}},prettyTimeFromDate:function(data){var jsDate=data.date;var amOrPm=this.amOrPmForHour({hour:jsDate.getHours()});var hour=this.twelveHourHour({hour:jsDate.getHours()});var minutes=jsDate.getMinutes();return hour+":"+this.doubleDigitNum({num:minutes})+amOrPm;},prettyTimeFromMySQLDate:function(data){var jsDate=this.dateFromMySQLDate({dateString:data.dateString});return this.prettyTimeFromDate({date:jsDate});},twelveHourHour:function(data){var hour=data.hour;var hour=hour%12;hour=(hour==0)?12:hour;return hour;},amOrPmForHour:function(data){var hour=data.hour;return(hour>11)?TLConfigText['basic_pm']:TLConfigText['basic_am'];},doubleDigitNum:function(data){var num=Math.abs(parseInt(data.num));if(num==0){return"00";}
else if(num<10){return"0"+num;}
else{return num;}},quadrupleDigitNum:function(data){var num=Math.abs(parseInt(data.num));if(num==0){return"0000";}
else if(num<10){return"000"+num;}
else if(num<100){return"00"+num;}
else if(num<1000){return"0"+num;}
else{return num;}},deleteCookie:function(data){var name=data.name;document.cookie=name+'=; expires=Thu, 01-Jan-70 00:00:01 GMT; path=/';},setCookie:function(data){var name=data.name;var value=data.value;var expires=data.expires;var path=(data.path)?data.path:"/";var domain=data.domain;var secure=data.secure;var today=new Date();today.setTime(today.getTime());if(expires){expires=expires*1000*60*60*24;}
var expires_date=new Date(today.getTime()+(expires));document.cookie=name+"="+escape(value)+
((expires)?";expires="+expires_date.toGMTString():"")+
((path)?";path="+path:"")+
((domain)?";domain="+domain:"")+
((secure)?";secure":"");},getCookie:function(data){var name=data.name;var start=document.cookie.indexOf(name+"=");var len=start+name.length+1;if((!start)&&(name!=document.cookie.substring(0,name.length))){return null;}
if(start==-1){return null;}
var end=document.cookie.indexOf(";",len);if(end==-1){end=document.cookie.length;}
return unescape(document.cookie.substring(len,end));},removeItemFromArray:function(data){var item=data.item;var anArray=data.anArray;var itemIndex=anArray.indexOf(item);while(itemIndex!=-1){anArray.splice(itemIndex,1);itemIndex=anArray.indexOf(item);}
return anArray;},isItemInArray:function(data){var item=data.item;var anArray=data.anArray;for(var counter=0;counter<anArray.length;counter++){if(anArray[counter]==item){return true;}}
return false;},cloneArray:function(data){var anArray=data.anArray;var returnArray=new Array();for(var counter=0;counter<anArray.length;counter++){returnArray.push(anArray[counter]);}
return returnArray;},scrollbarWidth:function(){document.body.style.overflow='hidden';var width=document.body.clientWidth;document.body.style.overflow='scroll';width-=document.body.clientWidth;if(!width)width=document.body.offsetWidth-document.body.clientWidth;document.body.style.overflow='';return width;},decode_base64:function(s){var e={},i,k,v=[],r="",w=String.fromCharCode;var n=[[65,91],[97,123],[48,58],[47,48],[43,44]];for(z in n){for(i=n[z][0];i<n[z][1];i++){v.push(w(i));}}
for(i=0;i<64;i++){e[v[i]]=i;}
for(i=0;i<s.length;i+=72){var b=0,c,x,l=0,o=s.substring(i,i+72);for(x=0;x<o.length;x++){c=e[o.charAt(x)];b=(b<<6)+c;l+=6;while(l>=8){r+=w((b>>>(l-=8))%256);}}}
return r;},extend:function(subClass,superClass){var F=function(){};F.prototype=superClass.prototype;subClass.prototype=new F();subClass.prototype.constructor=subClass;subClass.superClass=superClass.prototype;if(superClass.prototype.constructor==Object.prototype.constructor){superClass.prototype.constructor=superClass;}},clipToMaxCharWords:function(data){var aString=data.aString;var maxChars=data.maxChars;if(aString.length<=maxChars){return aString;}
var wordarray=aString.split(" ");var numwords=wordarray.length;var newstring="";var laststring="";for(var counter=0;counter<numwords;counter++){laststring=newstring
if(counter!=0){newstring+=(" "+wordarray[counter]);}
else{newstring+=wordarray[counter];}
if(newstring.length>maxChars){return(laststring+"...");}}
return newstring;},viewportSize:function(){var myWidth=0,myHeight=0;if(typeof(window.innerWidth)=='number'){myWidth=window.innerWidth;myHeight=window.innerHeight;}
else if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){myWidth=document.documentElement.clientWidth;myHeight=document.documentElement.clientHeight;}
else if(document.body&&(document.body.clientWidth||document.body.clientHeight)){myWidth=document.body.clientWidth;myHeight=document.body.clientHeight;}
myWidth=(!myWidth)?100:myWidth;myHeight=(!myHeight)?100:myHeight;return{width:myWidth,height:myHeight}},decipherQueryResult:function(data){return data.queryResult;},adjustColour:function(data){var colour=data.colour;var adjust=data.adjust;var num=parseInt(colour,16);var r=parseInt((num>>16)*adjust);var b=parseInt(((num>>8)&0x00FF)*adjust);var g=parseInt((num&0x0000FF)*adjust);r=(r<0)?0:(r>255)?255:r;b=(b<0)?0:(b>255)?255:b;g=(g<0)?0:(g>255)?255:g;var newColor=g|(b<<8)|(r<<16);newColor=newColor.toString(16);for(var counter=6-newColor.length;counter>0;counter--){newColor="0"+newColor;}
return newColor;},removeScript:function(data){var content=data.content;if(!content||this.isScriptable){return content;}
content=content.replace(/&/g,"yugh678323");var domDiv=$("<div>"+content+"</div>").get()[0];$(domDiv).find("script").remove();var retContent=$(domDiv).html();if(retContent){retContent=retContent.replace(/yugh678323/g,"&");}
return retContent;}}
var AJKKeyEvent=function(){var self=this;self.observers=new Array();self.isInputFocussed=false;}
AJKKeyEvent.prototype={init:function(){var self=this;$(document).keyup(function(e){if(e.target.tagName!="INPUT"&&e.target.tagName!="TEXTAREA"){self.informObservers({key:e.keyCode,mode:"keyup"});}});return self;},informObservers:function(data){var self=this;$.each(self.observers,function(){if(this.keyEventTookPlace){this.keyEventTookPlace(data);}});},registerAsObserver:function(data){var self=this;var observer=data.observer;self.observers=AJKHelpers.removeItemFromArray({anArray:self.observers,item:observer})
self.observers.push(observer);},removeAsObserver:function(data){var self=this;var observer=data.observer;self.observers=AJKHelpers.removeItemFromArray({anArray:self.observers,item:observer})}}
var AJKWindowResizeEvent=function(){var self=this;self.observers=new Array();self.lastWindowSize={width:0,height:0};self.domBody=$("body").get()[0];self.scrollBarsHidden=false;self.showScrollBarTimer="";}
AJKWindowResizeEvent.prototype={init:function(){var self=this;var viewportSize=AJKHelpers.viewportSize();self.lastWindowSize.width=viewportSize.width;self.lastWindowSize.height=viewportSize.height;$(window).resize(function(){self.informObservers();self.hideScrollBars();});return self;},hideScrollBars:function(){var self=this;if(!self.scrollBarsHidden){$(self.domBody).addClass("tl-overflow-hidden");self.scrollBarsHidden=true;}
if(self.showScrollBarTimer){clearTimeout(self.showScrollBarTimer);}
self.showScrollBarTimer=setTimeout(function(){$(self.domBody).removeClass("tl-overflow-hidden");self.scrollBarsHidden=false;},200);},informObservers:function(){var self=this;var informFunc=function(){var viewportSize=AJKHelpers.viewportSize();viewportSize.width=(viewportSize.width)?viewportSize.width:1;viewportSize.height=(viewportSize.height)?viewportSize.height:1;if(!(viewportSize.width==self.lastWindowSize.width&&viewportSize.height==self.lastWindowSize.height)){self.lastWindowSize.width=viewportSize.width;self.lastWindowSize.height=viewportSize.height;$.each(self.observers,function(){this.windowDidResize({newSize:viewportSize});});}}
if($.browser.msie){setTimeout(function(){informFunc();},500);}
else{informFunc();}},registerAsObserver:function(dataObj){var self=this;var observer=dataObj.observer;self.observers=AJKHelpers.removeItemFromArray({anArray:self.observers,item:observer})
self.observers.push(observer);},removeAsObserver:function(dataObj){var self=this;var observer=dataObj.observer;self.observers=AJKHelpers.removeItemFromArray({anArray:self.observers,item:observer})}}
var AJKValueSlider=function(data){var self=this;self.domRoot=data.domRoot;self.domDragger=data.domDragger;self.limitFunc=data.limitFunc;self.dragger="";self.value="";self.range=data.range;self.callback=data.callback;self.name=data.name;}
AJKValueSlider.slidersByName=[];AJKValueSlider.prototype={init:function(){var self=this;AJKValueSlider.slidersByName[self.name]=self;self.dragger=new AJKDraggable({domDragEl:self.domDragger,limitFunc:self.limitFunc,mouseMoveFunc:function(data){var newVal=data.dragElPos.x/self.limitFunc().maxX*(self.range.max-self.range.min)+self.range.min;self.callback({newVal:newVal});},dragDidStartFunc:function(){},dragDidEndFunc:function(data){}}).init();return self;},setValue:function(data){var self=this;self.value=(data.value)?parseFloat(data.value):self.range.min;var maxPos=self.limitFunc().maxX;var pos=(self.value-self.range.min)/(self.range.max-self.range.min)*maxPos;$(self.domDragger).css({left:pos});}}
var AJKVerifier=function(data){this.domRootEl=data.domRootEl;this.domFields=$(this.domRootEl).find(".ajk-verifier-field").get();this.domSubmitButton=$(this.domRootEl).find(".ajk-verifier-submit").get()[0];this.domCancelButton=$(this.domRootEl).find(".ajk-verifier-cancel").get()[0];this.domRevertButton=$(this.domRootEl).find(".ajk-verifier-revert").get()[0];this.domTooltipDisplay=$(this.domRootEl).find(".ajk-verifier-tooltip-displayer").get()[0];this.domErrorMessage=$(this.domRootEl).find(".ajk-verifier-error-message").get()[0];this.domSuccessMessage=$(this.domRootEl).find(".ajk-verifier-success-message").get()[0];this.defaultErrorMessage=$(this.domErrorMessage).text();this.submitFunc=data.submitFunc;this.cancelFunc=data.cancelFunc;this.revertFunc=data.revertFunc;this.objFields=new Array();this.objFieldsByKey=new Array();this.numFields=this.domFields.length;this.onChangeCallback="";this.onKeyUpCallback="";this.savedFieldValues="";this.disableSaveAndRevertClass="ajk-verifier-disable-save-and-revert";self.saveAndRevertDisabled=false;return this;}
AJKVerifier.prototype={init:function(){var self=this;$(this.domRootEl).find("form").each(function(){$(this).submit(function(){return false});});var counter=0;$.each(self.domFields,function(){var isLast=(++counter==self.numFields)?true:false;var aNewField=new AJKVerifierField({domRootEl:this,isLast:isLast,fieldHoverFunc:function(data){self.displayTooltip(data);},clearAllErrorsFunc:function(data){self.clearAllErrors(data);},controller:self}).init();self.objFields.push(aNewField);self.objFieldsByKey[aNewField.fieldName]=aNewField;});if(!self.domErrorMessage){self.hideErrorMessage=function(){};self.displayErrorMessage=function(){};}
if(!self.domTooltipDisplay){self.displayTooltip=function(){};}
$(self.domSubmitButton).click(function(){self.attemptToSubmit();return false;});$(self.domCancelButton).click(function(){if(self.cancelFunc){self.cancelFunc();}
return false;});$(self.domRevertButton).click(function(){if(self.revertFunc&&!self.saveAndRevertDisabled){self.revertFunc();self.clearAllErrors();}
return false;});return self;},fireButton:function(data){var self=this;var buttonType=data.buttonType;switch(buttonType){case"revert":$(self.domRevertButton).click();break;case"save":$(self.domSubmitButton).click();break;case"cancel":$(self.domCancelButton).click();break;}},showCancelButton:function(){var self=this;if(self.domCancelButton){$(self.domCancelButton).css({display:"block"});}},showRevertButton:function(){var self=this;if(self.domRevertButton){$(self.domRevertButton).css({display:"block"});}},hideCancelButton:function(){var self=this;if(self.domCancelButton){$(self.domCancelButton).css({display:"none"});}},hideRevertButton:function(){var self=this;if(self.domRevertButton){$(self.domRevertButton).css({display:"none"});}},enableSaveAndRevert:function(){var self=this;$(self.domRootEl).removeClass(self.disableSaveAndRevertClass);self.saveAndRevertDisabled=false;},disableSaveAndRevert:function(){var self=this;$(self.domRootEl).addClass(self.disableSaveAndRevertClass);self.saveAndRevertDisabled=true;},setFieldValues:function(data){var self=this;var fieldValues=data.fieldValues;var forceChangeEvent=data.forceChangeEvent;for(var fieldName in fieldValues){if(self.objFieldsByKey[fieldName]){var oldValue=self.objFieldsByKey[fieldName].getValue();self.objFieldsByKey[fieldName].forceSetValue({value:fieldValues[fieldName]});if(forceChangeEvent=="auto"){if(oldValue!=fieldValues[fieldName]){self.fieldDidChange({fieldName:fieldName,fieldValue:self.objFieldsByKey[fieldName].fieldValue});}}
else if(forceChangeEvent){self.fieldDidChange({fieldName:fieldName,fieldValue:self.objFieldsByKey[fieldName].fieldValue});}}}},getFieldValueFromName:function(data){var self=this;var fieldName=data.fieldName;return self.objFieldsByKey[fieldName].getValue();},attemptToSubmit:function(){var self=this;if(self.saveAndRevertDisabled){return false;}
if(self.verifyFields()){self.submit();}
else{self.displayErrorMessage({message:self.defaultErrorMessage})}},errorHighlightField:function(data){var self=this;var fieldName=data.fieldName;self.objFieldsByKey[fieldName].highlightError();},displayErrorMessage:function(data){var self=this;var message=data.message;$(self.domErrorMessage).html(message).css({display:"block"});self.hideSuccessMessage();},hideErrorMessage:function(data){var self=this;$(self.domErrorMessage).css({display:"none"});},displaySuccessMessage:function(data){var self=this;if(self.domSuccessMessage){$(self.domSuccessMessage).css({display:"block"});}},hideSuccessMessage:function(data){var self=this;if(self.domSuccessMessage){$(self.domSuccessMessage).css({display:"none"});}},clearAllErrors:function(){var self=this;self.hideErrorMessage();self.hideSuccessMessage();$.each(self.objFields,function(){this.clearError();});},displayTooltip:function(data){var self=this;var tooltipText=data.tooltipText;if(tooltipText){$(self.domTooltipDisplay).html(tooltipText).css({display:"block"});}
else{$(self.domTooltipDisplay).html(tooltipText).css({display:"none"});}},verifyFields:function(){var self=this;var failedFields=0;$.each(self.objFields,function(){if(!this.verify()){failedFields++;this.highlightError();}});return(failedFields==0);},ensureValidColorHex:function(data){var self=this;var thisVal=data.colorHex;var regTxt=(/^(#)?([0-9a-fA-F]{3})([0-9a-fA-F]{3})?$/);if(thisVal&&regTxt.test(thisVal)){return thisVal.replace("#","");}
else{return"999999";}},submit:function(){var self=this;if(self.saveAndRevertDisabled){return false;}
$.each(self.objFields,function(){this.blur();});var fieldData=new Object();self.displaySuccessMessage();$.each(self.objFields,function(){var thisVal=this.fieldValue;if(thisVal&&thisVal.replace){if(this.controlType=="input text"){thisVal=thisVal.replace(/[\n\r]/g,"");}
thisVal=thisVal.replace(/[\t]/g,"");thisVal=thisVal.replace(/\x18/g,"");thisVal=thisVal.replace(/\u2028/g,"");thisVal=thisVal.replace(/\u2029/g,"");}
if(this.colorPicker){thisVal=self.ensureValidColorHex({colorHex:thisVal});}
fieldData[this.fieldName]=thisVal;});self.submitFunc({fieldData:fieldData});},saveFieldValues:function(){var self=this;self.savedFieldValues={};$.each(self.objFields,function(){self.savedFieldValues[this.fieldName]=this.fieldValue;});},clearSavedFieldValues:function(){var self=this;self.savedFieldValues={};$.each(self.objFields,function(){self.savedFieldValues[this.fieldName]="";});},restoreSavedFieldValues:function(){var self=this;if(self.savedFieldValues){self.setFieldValues({fieldValues:self.savedFieldValues,forceChangeEvent:"auto"});}
self.disableSaveAndRevert();},restoreOldValueForField:function(data){var self=this;var fieldName=data.fieldName;self.objFieldsByKey[fieldName].forceSetValue({value:self.objFieldsByKey[fieldName].oldFieldValue});if(!self.areValuesDifferentFromSavedValues()){self.disableSaveAndRevert();}},restoreSavedValueForField:function(data){var self=this;var fieldName=data.fieldName;if(self.savedFieldValues&&self.savedFieldValues[fieldName]){self.objFieldsByKey[fieldName].forceSetValue({value:self.savedFieldValues[fieldName]});self.fieldDidChange({fieldName:fieldName,fieldValue:self.objFieldsByKey[fieldName].fieldValue});if(!self.areValuesDifferentFromSavedValues()){self.disableSaveAndRevert();}}},clearFields:function(){var self=this;$.each(self.objFields,function(){this.clear();});},fieldDidChange:function(data){var self=this;var fieldName=data.fieldName;var fieldValue=data.fieldValue;if(self.onChangeCallback){self.onChangeCallback({fieldName:fieldName,fieldValue:fieldValue});}
if(self.areValuesDifferentFromSavedValues()){self.enableSaveAndRevert();}
else{self.disableSaveAndRevert();}},fieldDidKeyUp:function(data){var self=this;var fieldName=data.fieldName;var fieldValue=data.fieldValue;if(self.onKeyUpCallback){self.onKeyUpCallback({fieldName:fieldName,fieldValue:fieldValue});}
if(self.areValuesDifferentFromSavedValues()){self.enableSaveAndRevert();}
else{self.disableSaveAndRevert();}},areValuesDifferentFromSavedValues:function(){var self=this;if(self.savedFieldValues){var difference=false;$.each(self.objFields,function(){if(this.getValue()!=self.savedFieldValues[this.fieldName]){difference=true;}});return difference;}
else{return true;}}}
var AJKVerifierField=function(data){this.domRootEl=data.domRootEl;this.fieldHoverFunc=data.fieldHoverFunc;this.clearAllErrorsFunc=data.clearAllErrorsFunc;this.isLast=data.isLast;this.controller=data.controller;this.domFormat="";this.domChars="";this.domTooltip="";this.domControl="";this.tooltip="";this.format="";this.chars="";this.defaultValue="";this.controlType="";this.fieldValue="";this.fieldName="";this.defaultValueOkay="";this.valueOptions="";this.colorPicker=false;this.oldFieldValue="";return this;}
AJKVerifierField.prototype={init:function(){var self=this;self.domFormat=$(this.domRootEl).find(".ajk-verifier-format");self.domChars=$(this.domRootEl).find(".ajk-verifier-chars");self.domTooltip=$(this.domRootEl).find(".ajk-verifier-tooltip");self.domControl=$(this.domRootEl).find(".ajk-verifier-control");self.tooltip=(self.domTooltip.length>0)?$(self.domTooltip).text():"";self.format=(self.domFormat.length>0)?$(self.domFormat).text():"";self.chars=(self.domChars.length>0)?$(self.domChars).text():"";self.domControl=(self.domControl.length>0)?$(self.domControl).get()[0]:"";self.domOverlay=$(self.domRootEl).find(".ajk-verifier-overlay").get()[0];self.defaultValueOkay=($(this.domRootEl).find(".ajk-verifier-not-default-value").length>0)?false:true;self.hideDefaultValue=($(this.domRootEl).find(".ajk-verifier-hide-default-value").length>0)?true:false;var domOptionValues=$(this.domRootEl).find(".ajk-verifier-value-options");self.valueOptions=(domOptionValues.length>0)?$(domOptionValues).text().split():"";self.fieldName=$(self.domControl).attr("name");if(self.chars){var charArray=self.chars.split("-");self.chars={minChar:charArray[0],maxChar:charArray[1]}}
self.calculateControlType();self.setupValueGetterSetter();self.setupVerificationFunction();self.setupTooltip();self.setupFocus();self.setupClick();self.setupKeyEvents();self.invalidDateMessage=(TLConfigText&&TLConfigText['verifier_invaldiDate_message'])?TLConfigText['verifier_invaldiDate_message']:"Not a valid date";if($(self.domControl).hasClass("ajk-color-selector")&&typeof AJKColorPicker!="undefined"){self.colorPicker=new AJKColorPicker.color(self.domControl,{});}
if(self.domOverlay){self.initOverlay();}
return self;},initOverlay:function(){var self=this;$(self.domOverlay).click(function(){$(this).css({display:"none"});$(self.domControl).focus();});$(self.domControl).focus(function(){$(self.domOverlay).css({display:"none"});});$(self.domControl).blur(function(){if($(this).val()==""){$(self.domOverlay).css({display:"block"});}});},setupValueGetterSetter:function(){var self=this;switch(self.controlType){case"span ajk-custom-checkbox":self.getValue=function(){return $(this.domControl).text();}
self.setValue=function(data){$(this.domControl).text(data.value);}
break;case"textarea textarea":self.getValue=function(){return AJKHelpers.removeScript({content:$(this.domControl).val()});}
self.setValue=function(data){$(this.domControl).val(AJKHelpers.removeScript({content:data.value}));}
break;case"select":self.getValue=function(){return $(this.domControl).val();}
self.setValue=function(data){$(this.domControl).val(data.value);}
break;default:self.getValue=function(){return AJKHelpers.removeScript({content:$(this.domControl).val()});}
self.setValue=function(data){$(this.domControl).val(AJKHelpers.removeScript({content:data.value}));self.updateValueSlider({value:data.value});}
break;}},updateValueSlider:function(data){var self=this;var thisSlider=AJKValueSlider.slidersByName[self.fieldName];if(thisSlider){thisSlider.setValue({value:data.value});}},calculateControlType:function(){var self=this;var tagName=self.domControl.tagName;var type=$(self.domControl).attr("type");self.controlType=(tagName+" "+type).toLowerCase();if(tagName=="SELECT"){self.controlType="select";}
if(self.controlType=="input password"){self.controlType="input text";}},setupClick:function(){var self=this;switch(self.controlType){case"span ajk-custom-checkbox":self.fieldValue=self.getValue();$(self.domControl).click(function(){if(self.fieldValue=="on"){self.fieldValue="off";$(this).removeClass("checkbox-selected");}
else{self.fieldValue="on";$(this).addClass("checkbox-selected");}
self.clearAllErrorsFunc();return false;});break;default:break;}},setupFocus:function(){var self=this;switch(self.controlType){case"input text":self.fieldValue=self.defaultValue=$(self.domControl).val();$(self.domControl).focus(function(){var thisVal=self.getValue();if(self.format=="date"&&thisVal==self.invalidDateMessage){self.setValue({value:""});}
if(thisVal==self.defaultValue&&(!self.defaultValueOkay||self.hideDefaultValue)){self.setValue({value:""});}
$(self.domRootEl).addClass("ajk-verifier-field-focused");self.clearAllErrorsFunc();}).blur(function(){var thisVal=self.getValue();if(self.format=="date"){var parsedDate=Date.parse(thisVal);if(parsedDate){var formatedDate=AJKHelpers.formatDate({formatString:"DD MMM YYYY HH:mm:ss",date:parsedDate,language:"base"});self.setValue({value:formatedDate});thisVal=formatedDate;}
else{self.setValue({value:self.invalidDateMessage});thisVal=self.invalidDateMessage;}}
if(!thisVal){self.setValue({value:self.defaultValue});}
self.oldFieldValue=self.fieldValue;self.fieldValue=thisVal;if(self.oldFieldValue!=thisVal){self.controller.fieldDidChange({fieldName:self.fieldName,fieldValue:thisVal});}
$(self.domRootEl).removeClass("ajk-verifier-field-focused");});break;case"textarea textarea":self.fieldValue=self.defaultValue=$(self.domControl).val();$(self.domControl).focus(function(){var thisVal=self.getValue();if(thisVal==self.defaultValue){}
$(self.domRootEl).addClass("ajk-verifier-field-focused");self.clearAllErrorsFunc();}).blur(function(){var thisVal=self.getValue();if(!thisVal){}
if(self.fieldValue!=thisVal){self.controller.fieldDidChange({fieldName:self.fieldName,fieldValue:thisVal});}
self.fieldValue=thisVal;$(self.domRootEl).removeClass("ajk-verifier-field-focused");});break;case"select":self.fieldValue=$(self.domControl).val();$(self.domControl).focus(function(){$(self.domRootEl).addClass("ajk-verifier-field-focused");self.clearAllErrorsFunc();}).blur(function(){var thisVal=self.getValue();if(self.fieldValue!=thisVal){self.controller.fieldDidChange({fieldName:self.fieldName,fieldValue:thisVal});}
self.fieldValue=thisVal;$(self.domRootEl).removeClass("ajk-verifier-field-focused");}).change(function(){$(self.domControl).blur();});break;default:break;}},setupKeyEvents:function(){var self=this;if(self.format=="number"){$(self.domControl).keydown(function(e){var charCode=e.keyCode;if((charCode>=48&&charCode<=57)||charCode==8||charCode==13||charCode==9||charCode==37||charCode==39||charCode==46||charCode==17||charCode==18||(charCode>=96&&charCode<=105)){return true;}
else{return false;}});}
$(self.domControl).keyup(function(e){self.controller.fieldDidKeyUp({fieldName:self.fieldName,fieldValue:$(this).val()});});if(self.isLast&&self.controlType=="input text"){$(self.domControl).keyup(function(e){if(e.keyCode==13){self.fieldValue=$(self.domControl).val();self.controller.attemptToSubmit();}});}},clear:function(){var self=this;switch(self.controlType){case"input text":self.fieldValue=(self.defaultValue)?self.defaultValue:"";$(self.domControl).val(self.fieldValue);if(self.domOverlay){$(self.domOverlay).css({display:"block"});}
break;case"textarea textarea":self.fieldValue=(self.defaultValue)?self.defaultValue:"";$(self.domControl).val(self.fieldValue);break;default:self.fieldValue=(self.defaultValue)?self.defaultValue:"";$(self.domControl).val(self.fieldValue);break;}},forceSetValue:function(data){var self=this;var value=data.value;switch(self.controlType){case"input text":self.oldFieldValue=self.fieldValue;self.fieldValue=value;$(self.domControl).val(value);self.updateValueSlider({value:value});break;case"textarea textarea":self.oldFieldValue=self.fieldValue;self.fieldValue=value;$(self.domControl).val(value);break;default:self.oldFieldValue=self.fieldValue;self.fieldValue=value;$(self.domControl).val(value);self.updateValueSlider({value:value});break;}
if(self.colorPicker){AJKColorPicker.fireEvent(self.domControl,"keyup");}},clearError:function(){var self=this;$(self.domRootEl).removeClass("ajk-verifier-field-error");},setupTooltip:function(){var self=this;$(self.domControl).hover(function(){self.fieldHoverFunc({tooltipText:self.tooltip});},function(){self.fieldHoverFunc({tooltipText:""});});},setupVerificationFunction:function(){var self=this;switch(self.format){case"email":self.verify=function(){var self=this;var fieldValue=self.getValue();if(!fieldValue||(fieldValue==self.defaultValue&&!self.defaultValueOkay)){return false;}
return fieldValue.match(/^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i);}
break;case"date":{self.verify=function(){var self=this;var fieldValue=self.getValue();if(!fieldValue||(fieldValue==self.defaultValue&&!self.defaultValueOkay)){return false;}
return(Date.parse(fieldValue))?true:false;}}
break;default:self.verify=function(){if(!self.defaultValueOkay&&self.fieldValue==self.defaultValue){return false;}
return(self.checkFieldCharLength()&&self.checkForValueOptions());}
break;}},verify:function(){},blur:function(){var self=this;$(self.domControl).blur();},highlightError:function(){var self=this;$(self.domRootEl).addClass("ajk-verifier-field-error");},checkFieldCharLength:function(){var self=this;if(!self.chars){return true;}
var fieldLength=self.fieldValue.length;return(fieldLength>=self.chars.minChar&&fieldLength<=self.chars.maxChar);},checkForValueOptions:function(){var self=this;if(!self.valueOptions){return true;}
var optionFound=false;$.each(self.valueOptions,function(){if(self.fieldValue==this){optionFound=true;}});return optionFound;}}
var AJKAlert=function(data){var self=this;self.domRoot=data.domRoot;self.domContent=$(self.domRoot).find(".ajk-alert-content").get()[0];self.domContentHeadline=$(self.domRoot).find(".ajk-alert-content-headline").get()[0];self.domContentBody=$(self.domRoot).find(".ajk-alert-content-body").get()[0];self.domClose=$(self.domRoot).find(".ajk-alert-close").get()[0];self.domContentButtonHolder=$(self.domRoot).find(".ajk-alert-content-button-holder").get()[0];self.preDisplaySetupFunc=data.preDisplaySetupFunc;self.closeOnBackClick=data.closeOnBackClick;}
AJKAlert.prototype={init:function(){var self=this;$(self.domRoot).click(function(){if(self.closeOnBackClick){self.close();}
return false;});$(self.domClose).click(function(){self.close();return false;});return self;},close:function(){var self=this;$(self.domRoot).css({display:"none",visibility:"hidden"});},displayMessage:function(data){var self=this;var headline=data.headline;var body=data.body;var buttons=(data.buttons)?data.buttons:new Array();var hideClose=data.hideClose;if(hideClose){$(self.domClose).css({display:"none"});}
else{$(self.domClose).css({display:"block"});}
$(self.domContentHeadline).html(data.headline);$(self.domContentBody).html(data.body);$(self.domContentButtonHolder).empty();$.each(buttons,function(){var button=this;var domButton=$(this.html).get()[0];$(domButton).click(function(){self.close();button.action();return false;});$(self.domContentButtonHolder).append(domButton);});$(self.domRoot).css({display:"block"});if(self.preDisplaySetupFunc){self.preDisplaySetupFunc();}
$(self.domRoot).css({visibility:"visible"});},fadeOut:function(){var self=this;$(self.domRoot).animate({opacity:0},500,function(){self.close();$(this).css({opacity:1});});}}
var AJKAjaxController=function(dataObj){self.loginController="";return this;}
AJKAjaxController.prototype={init:function(){var self=this;return self;},request:function(dataObj){var self=this;var action=dataObj.action;var vars=dataObj.vars;var callback=dataObj.callback;var method=dataObj.method;var alwaysAllow=dataObj.alwaysAllow;if(method=="get"||alwaysAllow||self.loginController.user.loggedIn){if(!vars.userId&&self.loginController.user.loggedIn){vars.userId=self.loginController.user.id;}
var rFunc=(method=="post")?$.post:$.get;rFunc(action,vars,function(data){if((typeof data)!="object"&&data=="verify-code-mismatch"){AJKHelpers.deleteCookie({name:self.loginController.userCookieName});location.reload(true);}
else if((typeof data)=="object"&&$(data).find("userNotValid").length>0){window.location.reload();}
else if(callback){callback(data);}});}
else{}}}
var AJKButtonPopupController=function(data){this.domButtons=data.domButtons;this.buttonPopups=new Array();this.buttonPopupsByKey=new Array();this.selectedPopup="";this.observers=new Array();this.adjustFunc=(data.adjustFunc)?data.adjustFunc:function(){return 0;}}
AJKButtonPopupController.prototype={init:function(){var self=this;$(self.domButtons).each(function(){var popupId=$(this).attr("popupId");if(popupId){var aButtonPopup=new AJKButtonPopup({domRootEl:$("#"+popupId).get()[0],domButton:this,controller:self,id:popupId}).init();self.buttonPopups.push(aButtonPopup);self.buttonPopupsByKey[popupId]=aButtonPopup;$(this).click(function(){if(self.selectedPopup==aButtonPopup){aButtonPopup.hide();self.popupDidClose();}
else{aButtonPopup.display();if(self.selectedPopup){self.selectedPopup.hide();self.popupDidClose();}
self.selectedPopup=aButtonPopup;self.popupDidOpen();}
return false;});}});return self;},popupDidOpen:function(){var self=this;if(self.observers[self.selectedPopup.id]){$.each(self.observers[self.selectedPopup.id],function(){if(this.buttonPopupDidOpen){this.buttonPopupDidOpen({popup:self.selectedPopup});}});}
theAJKKeyEvent.registerAsObserver({observer:self});},popupDidClose:function(){var self=this;if(self.observers[self.selectedPopup.id]){$.each(self.observers[self.selectedPopup.id],function(){if(this.buttonPopupDidClose){this.buttonPopupDidClose({popup:self.selectedPopup});}});}
self.selectedPopup="";theAJKKeyEvent.removeAsObserver({observer:self});},registerAsObserverOfType:function(dataObj){var self=this;var type=dataObj.type;var observer=dataObj.observer;if(!self.observers[type]){self.observers[type]=new Array();}
self.observers[type].push(observer);},keyEventTookPlace:function(dataObj){var self=this;var key=dataObj.key;if(key==27&&self.selectedPopup){self.selectedPopup.hide();self.popupDidClose();}},forceOpenPopupOfType:function(dataObj){var self=this;var type=dataObj.type;if(!self.buttonPopupsByKey[type].open){$(self.buttonPopupsByKey[type].domButton).click();}},forceClosePopupOfType:function(dataObj){var self=this;var type=dataObj.type;if(self.buttonPopupsByKey[type].open){$(self.buttonPopupsByKey[type].domButton).click();}}}
var AJKButtonPopup=function(dataObj){this.domRootEl=dataObj.domRootEl;this.domButton=dataObj.domButton;this.id=dataObj.id;this.domCloseButtons=$(this.domRootEl).find("a.close").get();this.observers=new Array();this.open=false;this.controller=dataObj.controller;this.animateStartTop=-100;this.animateEndTop=40;}
AJKButtonPopup.prototype={init:function(){var self=this;$(self.domCloseButtons).click(function(){self.hide();self.controller.popupDidClose();return false;});return self;},display:function(){var self=this;var rightOffset=theAJKWindowResizeEvent.lastWindowSize.width-AJKHelpers.getCoordsOfDomEl({domEl:self.domButton}).x+self.controller.adjustFunc();rightOffset-=parseInt($(self.domButton).parent().width()/2);if($.browser.msie&&$.browser.version<9){$(self.domRootEl).css({top:self.animateStartTop,display:"block",right:rightOffset}).animate({top:self.animateEndTop},250,function(){});}
else{$(self.domRootEl).css({opacity:0,top:self.animateStartTop,display:"block",right:rightOffset}).animate({top:self.animateEndTop,opacity:1},250,function(){});}
self.open=true;},hide:function(){var self=this;if($.browser.msie&&$.browser.version<9){$(self.domRootEl).animate({top:self.animateStartTop},250,function(){$(this).css({display:"none"});});}
else{$(self.domRootEl).animate({top:self.animateStartTop,opacity:0},250,function(){$(this).css({display:"none"});});}
self.open=false;}}
var TLLoginPanelController=function(data){var self=this;self.domRootEl=data.domRootEl;self.buttonPopupId=data.buttonPopupId;self.loginVerification="";self.controller=data.controller;self.domCarousel=$(self.domRootEl).find(".fp-carousel").get()[0];self.domStage=$(self.domRootEl).find(".fp-stage").get()[0];self.domBlocks=$(self.domRootEl).find(".fp-block").get();self.domForgottenPassword=$(self.domRootEl).find(".forgotten-password").get()[0];self.carouselBlockHeight="10.5em";self.selectedBlock=0;self.getLoginDetailsVerification="";self.loggingIn=false;}
TLLoginPanelController.prototype={init:function(){var self=this;$(self.domBlocks).css({height:self.carouselBlockHeight});$(self.domCarousel).css({height:self.carouselBlockHeight});$(self.domBlocks[0]).css({display:"block"});if(self.buttonPopupId){theAJKButtonPopupController.registerAsObserverOfType({type:self.buttonPopupId,observer:self});self.buttonPopupDidClose=function(){self.reset();}}
$(self.domRootEl).find(".ajk-pd-back-to-start").click(function(){self.jumpTo({pos:0});return false;});$(self.domForgottenPassword).click(function(){self.jumpTo({pos:1});return false;});self.loginVerification=new AJKVerifier({domRootEl:$(self.domRootEl).find(".fp-block-0").get()[0],submitFunc:function(data){if(self.loggingIn){return;}
self.loggingIn=true;data.fieldData["password"]=data.fieldData["tikitokipassword"];theAJKAjaxController.request({action:"/login/",method:"post",alwaysAllow:true,vars:data.fieldData,callback:function(xml){self.loggingIn=false;var error=$(xml).find("error").text();if(error){self.loginVerification.errorHighlightField({fieldName:"username"});self.loginVerification.errorHighlightField({fieldName:"tikitokipassword"});self.loginVerification.displayErrorMessage({message:TLConfigText['loginPopdown_incorrectLogin_message']});}
else{var userId=$(xml).find("userId").text();var username=$(xml).find("username").text();var verifyCode=$(xml).find("verifyCode").text();theAJKButtonPopupController.forceClosePopupOfType({type:self.buttonPopupId});setTimeout(function(){self.reset();},300);self.controller.logUserIn({userId:userId,username:username,verifyCode:verifyCode});}}});}}).init();self.getLoginDetailsVerification=new AJKVerifier({domRootEl:$(self.domRootEl).find(".fp-block-1").get()[0],submitFunc:function(data){self.jumpTo({pos:2});theAJKAjaxController.request({action:"/login/recovery/",method:"post",alwaysAllow:true,vars:data.fieldData,callback:function(xml){var error=$(xml).find("error").text();if(error){self.getLoginDetailsVerification.errorHighlightField({fieldName:"email"});self.getLoginDetailsVerification.displayErrorMessage({message:TLConfigText['loginPopdown_Email_not_in_database']});self.jumpTo({pos:1});}
else{self.jumpTo({pos:3});}}});}}).init();return self;},jumpTo:function(dataObj){var self=this;var newPos=dataObj.pos;var callback=dataObj.callback;var duration=(dataObj.instantly)?0:300;if(self.selectedBlock==newPos){return;}
var oldPos=self.selectedBlock;self.selectedBlock=newPos;self.carouselHeight=$(self.domCarousel).height();if(newPos>oldPos){$(self.domBlocks[newPos]).css({display:"block"});$(self.domStage).animate({marginTop:-self.carouselHeight},duration,function(){$(self.domBlocks[oldPos]).css({display:"none"});$(this).css({marginTop:"0"});if(callback){callback();}});}
else{$(self.domBlocks[newPos]).css({display:"block"});$(self.domStage).css({marginTop:-self.carouselHeight});$(self.domStage).animate({marginTop:0},duration,function(){$(self.domBlocks[oldPos]).css({display:"none"});if(callback){callback();}});}},reset:function(){var self=this;self.resetFields();self.jumpTo({pos:0,instantly:true});},resetFields:function(){var self=this;self.loginVerification.clearFields();self.loginVerification.clearAllErrors();}}
var TLSignupPanelController=function(data){var self=this;self.domRootEl=data.domRootEl;self.controller=data.controller;self.buttonPopupId=data.buttonPopupId;self.signUpVerification="";self.domCarousel=$(self.domRootEl).find(".fp-carousel").get()[0];self.domStage=$(self.domRootEl).find(".fp-stage").get()[0];self.domBlocks=$(self.domRootEl).find(".fp-block").get();self.carouselBlockHeight="21em";self.selectedBlock=0;self.domAutoLoginButton=$(self.domRootEl).find(".tl-signup-auto-login-button").get()[0];self.username="";self.userPassword="";self.userId;self.signingUp=false;}
TLSignupPanelController.prototype={init:function(){var self=this;$(self.domBlocks).css({height:self.carouselBlockHeight});$(self.domCarousel).css({height:self.carouselBlockHeight});$(self.domBlocks[0]).css({display:"block"});if(self.buttonPopupId){theAJKButtonPopupController.registerAsObserverOfType({type:self.buttonPopupId,observer:self});self.buttonPopupDidClose=function(){self.reset();}}
$(self.domAutoLoginButton).click(function(){self.controller.loginPanelController.loginVerification.setFieldValues({fieldValues:{username:self.username,tikitokipassword:self.userPassword}});self.controller.loginPanelController.loginVerification.fireButton({buttonType:"save"});theAJKButtonPopupController.forceClosePopupOfType({type:self.buttonPopupId});return false;});self.signUpVerification=new AJKVerifier({domRootEl:$(self.domRootEl).find(".ajk-verifier").get()[0],submitFunc:function(data){if(self.signingUp){return;}
self.signingUp=true;data.fieldData["password"]=data.fieldData["tikitokisignuppassword"];self.username=data.fieldData["username"];self.userPassword=data.fieldData["password"];data.fieldData["pupilClassCode"]=(data.fieldData["pupilClassCode"]==TLConfigText['signup_Enter_class_code'])?"":data.fieldData["pupilClassCode"];theAJKAjaxController.request({action:"/signup/",method:"post",alwaysAllow:true,vars:data.fieldData,callback:function(xml){self.signingUp=false;var anError=$(xml).find("error").text();if(anError&&anError=="error:username-already-exists"){self.signUpVerification.errorHighlightField({fieldName:"username"});self.signUpVerification.displayErrorMessage({message:TLConfigText['signup_Username_exists']});}
else if(anError&&anError=="error:email-already-exists"){self.signUpVerification.errorHighlightField({fieldName:"email"});self.signUpVerification.displayErrorMessage({message:TLConfigText['signup_Email_taken']});}
else if(anError&&anError=="error:too-many-pupils"){self.signUpVerification.errorHighlightField({fieldName:"pupilClassCode"});self.signUpVerification.displayErrorMessage({message:TLConfigText['signup_Class_accounts_full']});}
else if(anError&&anError=="error:incorrect-class-code"){self.signUpVerification.errorHighlightField({fieldName:"pupilClassCode"});self.signUpVerification.displayErrorMessage({message:TLConfigText['signup_Incorrect_class_code']});}
else{self.userId=$(xml).find("userId").text();self.jumpTo({pos:1});}}});}}).init();return self;},jumpTo:function(dataObj){var self=this;var newPos=dataObj.pos;var callback=dataObj.callback;var duration=(dataObj.instantly)?0:300;if(self.selectedBlock==newPos){return;}
var oldPos=self.selectedBlock;self.selectedBlock=newPos;self.carouselHeight=$(self.domCarousel).height();if(newPos>oldPos){$(self.domBlocks[newPos]).css({display:"block"});$(self.domStage).animate({marginTop:-self.carouselHeight},duration,function(){$(self.domBlocks[oldPos]).css({display:"none"});$(this).css({marginTop:"0"});if(callback){callback();}});}
else{$(self.domBlocks[newPos]).css({display:"block"});$(self.domStage).css({marginTop:-self.carouselHeight});$(self.domStage).animate({marginTop:0},duration,function(){$(self.domBlocks[oldPos]).css({display:"none"});if(callback){callback();}});}},reset:function(){var self=this;self.resetFields();self.jumpTo({pos:0,instantly:true});},resetFields:function(){var self=this;self.signUpVerification.clearFields();self.signUpVerification.clearAllErrors();}}
var TLStandardPageController=function(data){var self=this;self.loginPanelController="";self.userCookieName="TLUSERCOOKIE";self.secretUserCookieName="TLSECRETUSERCOOKIE";self.cookieSeparator="-?#-";self.domFeedItemSelector=$(".ajk-feed-item-selector").get()[0];self.user={loggedIn:false,id:"",username:"",verifyCode:"",timelines:new Array(),timelinesByKey:new Array(),accountType:""}
self.newTimelineController="";}
TLStandardPageController.prototype={init:function(){var self=this;$(".tlsp-big-carousel").each(function(){new TLSPBigCarousel({domRoot:this}).init();});$(".tlsp-jump-to-sign-up").click(function(){$.scrollTo($("#tlsp-hp-content-block-sign-up").get()[0],750);return false;});$(".tlsp-jump-to-account-info").click(function(){$.scrollTo($("#tlsp-hp-content-block-account-info").get()[0],750);return false;});$("#tlsp-logout-menu-item").click(function(){self.logUserOut();return false;});if(typeof TLAdminLightbox!="undefined"){TLAdminLightbox.panelPrototype=$(self.domFeedItemSelector).clone().get()[0];$(TLAdminLightbox.panelPrototype).find(".tl-panel-specific-content").empty();$(self.domFeedItemSelector).after(TLAdminLightbox.panelPrototype);}
var isUserLoggedIn=$(".tl-data-userId").text();if(isUserLoggedIn){AJKHelpers.deleteCookie({name:self.secretUserCookieName});self.loadUserCookie();}
self.loginPanelController=new TLLoginPanelController({domRootEl:$("#ajk-pop-down-panel-login").get()[0],buttonPopupId:"ajk-pop-down-panel-login",controller:self}).init();theAJKAjaxController.loginController=loginController=self;new TLSignupPanelController({domRootEl:$("#ajk-pop-down-panel-sign-up").get()[0],buttonPopupId:"ajk-pop-down-panel-sign-up",controller:self}).init();self.domPrototypeAlert=$("#tlsp-create-timeline-form .ajk-alert").clone().get()[0];if(isUserLoggedIn){self.newTimelineController=new TLStandardPageNewTimelineController({controller:self}).init();new TLHomeAccountManagement({controller:self}).init();new TLStandardPageFormHelpController({domRoot:$("#tlsp-help-popup").get()[0]}).init();self.deleteTimelineController=new TLSPDeleteTimelineController().init();self.copyTimelineController=new TLSPCopyTimelineController({newTimelineController:self.newTimelineController}).init();if(self.domFeedItemSelector){TLAdminLightbox.panelPrototype=$(self.domFeedItemSelector).clone().get()[0];$(TLAdminLightbox.panelPrototype).find(".tl-panel-specific-content").empty();$(TLAdminLightbox.panelPrototype).removeClass("tl-ah-flickr-image-selector");$(self.domFeedItemSelector).after(TLAdminLightbox.panelPrototype);}
self.setUpImageSelector();if(typeof AJKDatePickerController!="undefined"){new AJKDatePickerController({domRoot:$("body").get()[0]}).init();}
$("#tlsp-teacher-pupil-list").each(function(){new TLHomeTeacherPupilList({domRoot:this,controller:self}).init();});}
return self;},logUserOut:function(){var self=this;self.deleteUserCookies();window.location="/";},deleteUserCookies:function(){var self=this;AJKHelpers.deleteCookie({name:self.userCookieName});AJKHelpers.deleteCookie({name:self.secretUserCookieName});},logUserIn:function(data){var self=this;self.deleteUserCookies();self.user.loggedIn=true;self.user.id=data.userId;self.user.username=data.username;self.user.verifyCode=data.verifyCode;self.saveUserCookie();window.location="/account/";},saveUserCookie:function(data){var self=this;var cookieName=(data&&data.cookieName)?data.cookieName:self.userCookieName;var expires=(data&&data.expires)?data.expires:30;expires=(data&&data.expires&&data.expires=="now")?0:expires;var cookieString=self.user.id+self.cookieSeparator;cookieString+=self.user.username+self.cookieSeparator;cookieString+=self.user.verifyCode+self.cookieSeparator;AJKHelpers.setCookie({name:cookieName,value:cookieString,expires:expires});},loadUserCookie:function(data){var self=this;var cookieName=(data&&data.cookieName)?data.cookieName:self.userCookieName;var cookieData=AJKHelpers.getCookie({name:cookieName});if(cookieData){cookieDataSplit=cookieData.split(self.cookieSeparator);self.user.id=cookieDataSplit[0];self.user.username=cookieDataSplit[1];self.user.verifyCode=cookieDataSplit[2];self.user.loggedIn=true;return true;}},loadTimeline:function(data){var self=this;var timeline=data.timeline;window.location="/timeline/entry/"+timeline.id+"/"+timeline.urlFriendlyTitle+"/";},isEndDateBeforeStartDateForVerifier:function(data){var self=this;var verifier=data.verifier;var startDate=Date.parse(verifier.getFieldValueFromName({fieldName:"startDate"}));var endDate=Date.parse(verifier.getFieldValueFromName({fieldName:"endDate"}));return startDate.getTime()>endDate.getTime();},isDateWithinAllowableRange:function(){var self=this;return true;},setUpImageSelector:function(){var self=this;if(!self.domFeedItemSelector){return;}
self.imageSelector=new AJKImageSelector({controller:self,timeline:self.timeline,domFeedItemSelector:self.domFeedItemSelector,isStandardPage:true}).init();$(".tlsp-field-image-selector").each(function(){var thisDomInput=$(this).find("input").get()[0];var thisDomSearchButton=$(this).find(".tlsp-fis-control").get()[0];var imageSize=$(this).find(".tl-ah-image-data-size").text();var domCaptionField="";var captionFieldId=$(this).find(".tl-ah-image-data-caption-field-id").text();if(captionFieldId){domCaptionField=$("#"+captionFieldId).get()[0];}
$(thisDomSearchButton).click(function(){self.imageSelector.launch({imageSize:imageSize,domContentField:thisDomInput,domCaptionField:domCaptionField});return false;});});},verifyTimelineFormDate:function(data){var self=this;var verifier=data.verifier;var aDate=data.date;var dateType=data.dateType;var newTimeline=(verifier==self.timelineFormVerification);var alertController=data.alertController;if(!aDate){alertController.displayMessage({headline:"Invalid Date",body:'<p>You have entered an invalid date. Please try again.</p>',buttons:[{html:'<a href="#" class="rt-button-3 rt-button-align-right">Continue</a>',action:function(){}}]});verifier.restoreOldValueForField({fieldName:dateType});return false;}
else if(self.isEndDateBeforeStartDateForVerifier({verifier:verifier})){alertController.displayMessage({headline:"Invalid Date",body:'<p>The start date for the timeline must precede the end date. Please try again. </p>',buttons:[{html:'<a href="#" class="rt-button-3 rt-button-align-right">Continue</a>',action:function(){}}]});verifier.restoreOldValueForField({fieldName:dateType});return false;}
else if(!self.isDateWithinAllowableRange({date:aDate})){alertController.displayMessage({headline:"Invalid Date",body:'<p>You have entered a date outside the range of allowable dates. We currently limit dates to be from -9999BC to 9999AD. Please try again.</p>',buttons:[{html:'<a href="#" class="rt-button-3 rt-button-align-right">Continue</a>',action:function(){}}]});verifier.restoreOldValueForField({fieldName:dateType});return false;}
return true;}}
var TLSPDeleteTimelineController=function(data){var self=this;}
TLSPDeleteTimelineController.prototype={init:function(){var self=this;$("#tlsp-admin-timeline-list").find(".tlsp-admin-list-item").each(function(){var domItem=this;self.initDeleteFunctionalityForItem({domItem:domItem});});return self;},initDeleteFunctionalityForItem:function(data){var self=this;var domItem=data.domItem;var timelineId=$(domItem).find(".tl-data-timeline-id").text();var domDelete=$(domItem).find(".tlsp-ali-delete").get()[0];$(domDelete).click(function(){self.confirmDeleteForTimelineId({timelineId:timelineId,domItem:domItem});return false;});},createDomConfirm:function(data){var self=this;var deleteFunc=data.deleteFunc;var cancelFunc=data.cancelFunc;var insertHTML='<span class="tlsp-ali-confirm">';insertHTML+='<span class="tlsp-ali-confirm-text">Really delete this timeline? <span class="tlsp-ali-confirm-yes">Yes</span> | <span class="tlsp-ali-confirm-no">No</span></span>';insertHTML+='</span>';var domConfirm=$(insertHTML).get()[0];$(domConfirm).click(function(){return false});$(domConfirm).find(".tlsp-ali-confirm-yes").click(function(){deleteFunc();$(this).unbind("click");return false;});$(domConfirm).find(".tlsp-ali-confirm-no").click(function(){cancelFunc();$(this).unbind("click");return false;});return domConfirm;},confirmDeleteForTimelineId:function(data){var self=this;var domItem=data.domItem;var timelineId=data.timelineId;var domConfirm=self.createDomConfirm({deleteFunc:function(){self.deleteTimelineWithId({timelineId:timelineId,domConfirm:domConfirm});},cancelFunc:function(){$(domConfirm).animate({opacity:0},500,function(){$(domConfirm).remove();});}});$(domConfirm).css({opacity:0});$(domItem).append(domConfirm);$(domConfirm).animate({opacity:1},500);},deleteTimelineWithId:function(data){var self=this;var timelineId=data.timelineId;var domConfirm=data.domConfirm;var vars={};vars["timelineId"]=timelineId;var action="/admin/deletetimeline/";$(domConfirm).find(".tlsp-ali-confirm-text").html("Deleting timeline...");theAJKAjaxController.request({action:action,method:"post",vars:vars,callback:function(xml){$(domConfirm).find(".tlsp-ali-confirm-text").html("Timeline deleted. Refreshing page...");window.location.reload(true);}});}}
var TLSPCopyTimelineController=function(data){var self=this;self.newTimelineController=data.newTimelineController;}
TLSPCopyTimelineController.prototype={init:function(){var self=this;$("#tlsp-admin-timeline-list").find(".tlsp-admin-list-item").each(function(){var domItem=this;self.initCopyFunctionalityForItem({domItem:domItem});});return self;},initCopyFunctionalityForItem:function(data){var self=this;var domItem=data.domItem;var timelineId=$(domItem).find(".tl-data-timeline-id").text();var domCopy=$(domItem).find(".tlsp-ali-copy").get()[0];$(domCopy).click(function(){if(self.newTimelineController.numRemainingUserTimelines<=0){var insertHTML='<span class="tlsp-ali-confirm">';insertHTML+='<span class="tlsp-ali-confirm-text">You have no spare timelines. Upgrade account to get more timelines.</span>';insertHTML+='</span>';var domMess=$(insertHTML).get()[0];$(domItem).append(domMess);setTimeout(function(){$(domMess).animate({opacity:0},500,function(){$(this).remove();});},3000);}
else{self.confirmCopyForTimelineId({timelineId:timelineId,domItem:domItem});}
return false;});},createDomConfirm:function(data){var self=this;var copyFunc=data.copyFunc;var cancelFunc=data.cancelFunc;var insertHTML='<span class="tlsp-ali-confirm">';insertHTML+='<span class="tlsp-ali-confirm-text">Duplicate this timeline? <span class="tlsp-ali-confirm-yes">Yes</span> | <span class="tlsp-ali-confirm-no">No</span></span>';insertHTML+='</span>';var domConfirm=$(insertHTML).get()[0];$(domConfirm).click(function(){return false});$(domConfirm).find(".tlsp-ali-confirm-yes").click(function(){copyFunc();$(this).unbind("click");return false;});$(domConfirm).find(".tlsp-ali-confirm-no").click(function(){cancelFunc();$(this).unbind("click");return false;});return domConfirm;},confirmCopyForTimelineId:function(data){var self=this;var domItem=data.domItem;var timelineId=data.timelineId;var domConfirm=self.createDomConfirm({copyFunc:function(){self.copyTimelineWithId({timelineId:timelineId,domConfirm:domConfirm});},cancelFunc:function(){$(domConfirm).animate({opacity:0},500,function(){$(domConfirm).remove();});}});$(domConfirm).css({opacity:0});$(domItem).append(domConfirm);$(domConfirm).animate({opacity:1},500);},copyTimelineWithId:function(data){var self=this;var timelineId=data.timelineId;var domConfirm=data.domConfirm;var vars={};vars["timelineId"]=timelineId;var action="/admin/copytimeline/";$(domConfirm).find(".tlsp-ali-confirm-text").html("Copying timeline...");theAJKAjaxController.request({action:action,method:"post",vars:vars,callback:function(xml){$(domConfirm).find(".tlsp-ali-confirm-text").html("Timeline copied. Refreshing page...");window.location.reload(true);}});}}
var TLStandardPageFormHelpController=function(data){var self=this;self.domRoot=data.domRoot;self.domContentHolder=$(self.domRoot).find(".content").get()[0];self.domParent=$(self.domRoot).parent().get()[0];self.focussedItem="";}
TLStandardPageFormHelpController.prototype={init:function(){var self=this;if(!self.domRoot){return;}
$(".tl-ahh-help-item").each(function(){var domHoverItem=$(this).find(".tl-ahh-help-hover-item").get()[0];var domInput=$(this).find("input,textarea").get()[0];var item={domContent:$(this).find(".tl-ahh-data-content").get()[0],domHoverItem:domHoverItem,itemHeight:$(domHoverItem).height()}
$(domHoverItem).hover(function(){self.displayHelpForItem({item:item});},function(){if(self.focussedItem){self.displayHelpForItem({item:self.focussedItem});}
else{self.hideHelp();}});$(domInput).focus(function(){self.displayHelpForItem({item:item});self.focussedItem=item;});$(domInput).blur(function(){if(self.focussedItem==item){self.focussedItem="";}
self.hideHelp();});});return self;},displayHelpForItem:function(data){var self=this;var item=data.item;$(self.domContentHolder).empty().append(item.domContent);var itemCoords=AJKHelpers.getCoordsOfDomEl({domEl:item.domHoverItem});var panelHeight=$(self.domRoot).height();var parentCoords=AJKHelpers.getCoordsOfDomEl({domEl:self.domParent});var topOffset=itemCoords.y-parentCoords.y-panelHeight;var leftOffset=itemCoords.x-parentCoords.x;$(self.domRoot).css({top:topOffset,left:leftOffset});},hideHelp:function(){var self=this;$(self.domRoot).css({top:-10000,left:-10000});}}
var TLStandardPageNewTimelineController=function(data){var self=this;self.verification="";self.domRoot=$("#tlsp-create-timeline-form").get()[0];self.controller=data.controller;self.domAlert=$(self.domRoot).find(".ajk-alert").get()[0];self.domAlertInner=$(self.domAlert).find(".tl-ah-alert-inner").get()[0];self.domAlertContent=$(self.domAlert).find(".tl-ah-alert-content").get()[0];self.alert="";self.numUserTimelines=parseInt($(".tl-data-num-timelines").text());self.numAllowableUserTimelines=parseInt($(".tl-data-num-allowable-timelines").text());self.numRemainingUserTimelines=self.numAllowableUserTimelines-self.numUserTimelines;}
TLStandardPageNewTimelineController.prototype={init:function(){var self=this;if(!self.domRoot){return self;}
self.alert=new AJKAlert({domRoot:self.domAlert,preDisplaySetupFunc:function(){var adminPanelHeight=AJKHelpers.calculateDomElHeight({domEl:self.domRoot})+40;$(self.domAlertInner).css({height:adminPanelHeight});var contentHeight=AJKHelpers.calculateDomElHeight({domEl:self.domAlertContent});var contentPos=parseInt((adminPanelHeight-contentHeight)/2,10);$(self.domAlertContent).css({top:contentPos});}}).init();if(self.numRemainingUserTimelines<=0){self.displayExceededTimelinesMessage();}
self.timelineFormVerification=new AJKVerifier({domRootEl:self.domRoot,cancelFunc:function(){},submitFunc:function(data){if(self.numRemainingUserTimelines<=0){self.displayExceededTimelinesMessage();return;}
if(self.currentlyCreatingTimeline){return;}
self.currentlyCreatingTimeline=true;var startDate=Date.parse(data.fieldData["startDate"]);if(!self.controller.verifyTimelineFormDate({verifier:self.timelineFormVerification,alertController:self.alert,date:startDate,dateType:"startDate"})){return false;}
var endDate=Date.parse(data.fieldData["endDate"]);if(!self.controller.verifyTimelineFormDate({verifier:self.timelineFormVerification,alertController:self.alert,date:endDate,dateType:"endDate"})){return false;}
data.fieldData["startDate"]=AJKHelpers.formatDate({date:Date.parse(data.fieldData["startDate"]),formatString:"YYYY-MM-DD HH:mm:ss",forceFullDate:true,language:"base"});data.fieldData["endDate"]=AJKHelpers.formatDate({date:Date.parse(data.fieldData["endDate"]),formatString:"YYYY-MM-DD HH:mm:ss",forceFullDate:true,language:"base"});data.fieldData["zoom"]="";self.alert.displayMessage({headline:"Saving",body:'<p>Please wait while we create your timeline.</p>'});theAJKAjaxController.request({action:"/admin/createtimeline/",method:"post",vars:data.fieldData,callback:function(xml){self.currentlyCreatingTimeline=false;var timelineId=$(xml).find("timelineId").text();var urlFriendlyTitle=$(xml).find("timelineUrlFriendlyTitle").text();if(timelineId){self.numRemainingUserTimelines--;self.createNewTimelineListing({timelineId:timelineId,urlFriendlyTitle:urlFriendlyTitle,title:data.fieldData.title});window.location="/timeline/entry/"+timelineId+"/"+urlFriendlyTitle+"/";}
else{self.alert.displayMessage({headline:"Error",body:'<p>Something went wrong with the creation of your timeline. You may have reached the limit of the number of timelines you can create with your account. Otherwise, please contact us at help@tiki-toki.com.</p>'});}}});}}).init();return self;},createNewTimelineListing:function(data){var self=this;var timelineId=data.timelineId;var title=data.title;var urlFriendlyTitle=data.urlFriendlyTitle;var iHTML='<a class="tlsp-admin-list-item" href="/timeline/entry/'+timelineId+'/'+urlFriendlyTitle+'/">';iHTML+='<span class="tl-data tl-data-timeline-id">'+timelineId+'</span>';iHTML+='<span class="tlsp-ali-title">'+title+'</span>';iHTML+='<span class="tlsp-ali-controls">';iHTML+='<span>Edit</span> | <span class="tlsp-ali-copy">Copy</span> | <span class="tlsp-ali-delete">Delete</span>';iHTML+='</span>';iHTML+='</a>';var domListing=$(iHTML).get()[0];self.controller.copyTimelineController.initCopyFunctionalityForItem({domItem:domListing});self.controller.deleteTimelineController.initDeleteFunctionalityForItem({domItem:domListing});$("#tlsp-admin-timeline-list").prepend(domListing);$("#tlsp-admin-timeline-list .tlsp-acb-no-chart-message").css({display:"none"});},displayExceededTimelinesMessage:function(){var self=this;self.alert.displayMessage({headline:"Timeline limit",body:"<div><p>You have reached your account's limit on the number of timelines you can create.</p><p>To create more timelines, please upgrade your account - see below.</p></div>"});}}
TLSignupPanelController.prototype.oldInit=TLSignupPanelController.prototype.init
TLSignupPanelController.prototype.init=function(){var self=this;self.oldInit();var domHomeSignup=$("#tlsp-home-sign-up").get()[0];if(domHomeSignup){var domAlert=$(domHomeSignup).find(".tl-ah-alert").get()[0];var domAlertInner=$(domAlert).find(".tl-ah-alert-inner").get()[0];var domAlertContent=$(domAlert).find(".tl-ah-alert-content").get()[0];var signupAlert=new AJKAlert({domRoot:domAlert,preDisplaySetupFunc:function(){var adminPanelHeight=AJKHelpers.calculateDomElHeight({domEl:domHomeSignup})+40;$(domAlertInner).css({height:adminPanelHeight});var contentHeight=AJKHelpers.calculateDomElHeight({domEl:domAlertContent});var contentPos=parseInt((adminPanelHeight-contentHeight)/2,10);$(domAlertContent).css({top:contentPos});}}).init();self.homeSignUpVerification=new AJKVerifier({domRootEl:domHomeSignup,submitFunc:function(data){data.fieldData["password"]=data.fieldData["tlsp-password"];self.username=data.fieldData["username"];self.userPassword=data.fieldData["password"];data.fieldData["pupilClassCode"]=(data.fieldData["pupilClassCode"]=="Enter class code")?"":data.fieldData["pupilClassCode"];signupAlert.displayMessage({headline:"Saving",body:'<p>Please wait while we create your account</p>'});theAJKAjaxController.request({action:"/signup/",method:"post",alwaysAllow:true,vars:data.fieldData,callback:function(xml){var anError=$(xml).find("error").text();if(anError&&anError=="error:username-already-exists"){self.homeSignUpVerification.errorHighlightField({fieldName:"username"});self.homeSignUpVerification.displayErrorMessage({message:"Username already taken. Try another"});signupAlert.close();}
else if(anError&&anError=="error:email-already-exists"){self.homeSignUpVerification.errorHighlightField({fieldName:"email"});self.homeSignUpVerification.displayErrorMessage({message:"Email already used. Try another"});signupAlert.close();}
else if(anError&&anError=="error:too-many-pupils"){self.homeSignUpVerification.errorHighlightField({fieldName:"pupilClassCode"});self.homeSignUpVerification.displayErrorMessage({message:"Class accounts full. Speak to teacher"});signupAlert.close();}
else if(anError&&anError=="error:incorrect-class-code"){self.homeSignUpVerification.errorHighlightField({fieldName:"pupilClassCode"});self.homeSignUpVerification.displayErrorMessage({message:"Incorrect class code"});signupAlert.close();}
else{self.userId=$(xml).find("userId").text();self.controller.loginPanelController.loginVerification.setFieldValues({fieldValues:{username:self.username,tikitokipassword:self.userPassword}});self.controller.loginPanelController.loginVerification.fireButton({buttonType:"save"});}}});}}).init();}
return self;}
var TLHomeAccountManagement=function(data){var self=this;self.controller=data.controller;self.user=self.controller.user;self.domRoot=$("#tlsp-account-settings").get()[0];self.domAlert=$(self.controller.domPrototypeAlert).clone().get()[0];self.domAlertInner=$(self.domAlert).find(".tl-ah-alert-inner").get()[0];self.domAlertContent=$(self.domAlert).find(".tl-ah-alert-content").get()[0];self.domPasswordField=$("#tl-ah-field-account-password").get()[0];self.alert="";self.verifier="";self.accountType=$(".tl-data-account-type").text();}
TLHomeAccountManagement.prototype={init:function(){var self=this;if(self.accountType=="Standard"){$(self.domRoot).find("#tlsp-account-multi-logins-holder").css({display:"none"});}
$(self.domRoot).append(self.domAlert);self.initialiseVerifier();self.initChangePassword();self.initPupilUpgrade();self.alert=new AJKAlert({domRoot:self.domAlert,preDisplaySetupFunc:function(){var adminPanelHeight=AJKHelpers.calculateDomElHeight({domEl:self.domRoot})+40;$(self.domAlertInner).css({height:adminPanelHeight});var contentHeight=AJKHelpers.calculateDomElHeight({domEl:self.domAlertContent});var contentPos=parseInt((adminPanelHeight-contentHeight)/2,10);$(self.domAlertContent).css({top:contentPos});}}).init();return false;},initialiseVerifier:function(){var self=this;self.verifier=new AJKVerifier({domRootEl:self.domRoot,revertFunc:function(){self.verifier.restoreSavedFieldValues();},submitFunc:function(data){var insertHTML='<div>';insertHTML+=TLConfigText["accountForm_confirmPassword_message"];insertHTML+=self.createFieldHTML();insertHTML+='</div>';var domBody=$(insertHTML).get()[0];var domInput=$(domBody).find("input").get()[0];setTimeout(function(){$(domInput).focus();},10);self.alert.displayMessage({headline:TLConfigText["accountForm_confirmPassword_headline"],body:domBody,buttons:[{html:'<a href="#" class="rt-button-4 rt-button-align-right">'+TLConfigText['adminBasic_Continue']+'</a>',action:function(){var enteredPassword=$(domInput).val();data.fieldData["password"]=enteredPassword;self.alert.displayMessage({headline:TLConfigText["adminBasic_Saving"],body:"<p>"+TLConfigText["adminBasic_Saving_message"]+"</p>"});theAJKAjaxController.request({action:"/admin/savebasicaccounddetails/",method:"post",vars:data.fieldData,callback:function(xml){var success=$(xml).find("success").text();if(success=="true"){self.verifier.saveFieldValues();self.verifier.disableSaveAndRevert();self.alert.fadeOut();}
else{self.alert.displayMessage({headline:TLConfigText["accountForm_confirmPassword_failure_headline"],body:"<p>"+TLConfigText["accountForm_confirmPassword_failure_message"]+"</p>",buttons:[{html:'<a href="#" class="rt-button-4 rt-button-align-right">'+TLConfigText["adminBasic_Try_again"]+'</a>',action:function(){self.verifier.fireButton({buttonType:"save"});}},{html:'<a href="#" class="rt-button-4 rt-button-align-right">'+TLConfigText["adminBasic_Cancel"]+'</a>',action:function(){}}]});}}});}},{html:'<a href="#" class="rt-button-4 rt-button-align-right">'+TLConfigText["adminBasic_Cancel"]+'</a>',action:function(){}}]});}}).init();self.verifier.saveFieldValues();self.verifier.disableSaveAndRevert();},initPupilUpgrade:function(){var self=this;$(self.domRoot).find("#tl-ah-activate-pupil-account").click(function(){var thisButton=this;insertHTML='<div>';insertHTML+="<p>"+TLConfigText["teacherAccount_pupilUpgradeText"]+"</p>";insertHTML+=self.createFieldHTML();insertHTML+='</div>';var domBody=$(insertHTML).get()[0];var domInput1=$(domBody).find("input").get()[0];setTimeout(function(){$(domInput1).focus();},10);self.alert.displayMessage({headline:TLConfigText["teacherAccount_pupilUpgradePanel_headine"],body:domBody,buttons:[{html:'<a href="#" class="rt-button-4 rt-button-align-right">'+TLConfigText['adminBasic_Cancel']+'</a>',action:function(){}},{html:'<a href="#" class="rt-button-4 rt-button-align-right">'+TLConfigText['adminBasic_Submit']+'</a>',action:function(){var classCode=$(domInput1).val();if(classCode){self.alert.displayMessage({headline:TLConfigText["teacherAccount_pupilUpgradePanel_Submitting_code"],body:"<p>"+TLConfigText["teacherAccount_pupilUpgradePanel_Submitting_code_message"]+"</p>"});theAJKAjaxController.request({action:"/admin/activatePupilAccount",method:"post",vars:{classCode:classCode},callback:function(xml){var anError=$(xml).find("error").text();if(anError){var errorMessage=(anError=="error:too-many-pupils")?TLConfigText["teacherAccount_pupilUpgradePanel_Submitting_code_error_1"]:TLConfigText["teacherAccount_pupilUpgradePanel_Submitting_code_error_2"];self.alert.displayMessage({headline:TLConfigText["teacherAccount_pupilUpgradePanel_Submitting_code_error_headline"],body:"<p>"+errorMessage+"</p>",buttons:[{html:'<a href="#" class="rt-button-4 rt-button-align-right">'+TLConfigText['adminBasic_Close']+'</a>',action:function(){}},{html:'<a href="#" class="rt-button-4 rt-button-align-right">'+TLConfigText['adminBasic_Try_again']+'</a>',action:function(){$(thisButton).click();}}]});}
else{self.alert.displayMessage({headline:TLConfigText["teacherAccount_pupilUpgradePanel_Success_headline"],body:"<p>"+TLConfigText["teacherAccount_pupilUpgradePanel_Success_message"]+"</p>",buttons:[{html:'<a href="#" class="rt-button-4 rt-button-align-right">'+TLConfigText['adminBasic_Continue']+'</a>',action:function(){window.location.reload(true);}}]});}}});}
else{$(thisButton).click();}}}]});return false;});},initChangePassword:function(data){var self=this;$(self.domPasswordField).find(".tlsp-ah-field-option").click(function(){var domChangeButton=this;insertHTML='<div>';insertHTML+="<p>"+TLConfigText["accountForm_changePassword_Enter_current_password"]+"</p>";insertHTML+=self.createFieldHTML();insertHTML+="<p></p><p>"+TLConfigText["accountForm_changePassword_Enter_new_password"]+"</p>";insertHTML+=self.createFieldHTML();insertHTML+='</div>';var domBody=$(insertHTML).get()[0];var domInput1=$(domBody).find("input").get()[0];var domInput2=$(domBody).find("input").get()[1];setTimeout(function(){$(domInput1).focus();},10);self.alert.displayMessage({headline:TLConfigText["accountForm_changePassword_headline"],body:domBody,buttons:[{html:'<a href="#" class="rt-button-4 rt-button-align-right">Change</a>',action:function(){self.alert.displayMessage({headline:TLConfigText["accountForm_changePassword_Saving_headline"],body:"<p>"+TLConfigText["accountForm_changePassword_Saving_message"]+"</p>"});var oldPassword=$(domInput1).val();var newPassword=$(domInput2).val();theAJKAjaxController.request({action:"/admin/updateuserpassword/",method:"post",vars:{oldPassword:oldPassword,newPassword:newPassword},callback:function(xml){var success=$(xml).find("success").text();if(success=="true"){var newPassStr=AJKHelpers.stringRepeat({aString:"*",multiplier:newPassword.length});$(self.domPasswordField).find(".tl-ah-uneditable-value p span").text(newPassStr);self.alert.fadeOut();}
else{self.alert.displayMessage({headline:TLConfigText["accountForm_changePassword_Failure_headline"],body:"<p>"+TLConfigText["accountForm_changePassword_Failure_message"]+"</p>",buttons:[{html:'<a href="#" class="rt-button-4 rt-button-align-right">'+TLConfigText['adminBasic_Try_again']+'</a>',action:function(){$(domChangeButton).click();}},{html:'<a href="#" class="rt-button-4 rt-button-align-right">'+TLConfigText['adminBasic_Cancel']+'</a>',action:function(){}}]});}}});}},{html:'<a href="#" class="rt-button-4 rt-button-align-right">'+TLConfigText['adminBasic_Cancel']+'</a>',action:function(){}}]});return false;});},createFieldHTML:function(){var self=this;var insertHTML='<div class="tl-ah-input">';insertHTML+='<div class="tl-ah-f-inner">';insertHTML+='<input class="ajk-verifier-control" value="" />';insertHTML+='</div>';insertHTML+='<div class="tl-ah-f-right"></div>';return insertHTML;}}
var TLHomeTeacherPupilList=function(data){var self=this;self.domRoot=data.domRoot;self.controller=data.controller;self.user=self.controller.user;self.teacherPupils=[];self.teacherPupilsById=[];self.pupilInfoLightbox="";self.domPupilPanelContent=$("#tl-ah-pupil-info-panel").get()[0];self.totalAccounts=parseInt($(self.domRoot).find(".tlsp-tpl-num-accounts").text(),10);return self;}
TLHomeTeacherPupilList.prototype={init:function(){var self=this;self.setupList();return self;},setupList:function(){var self=this;theAJKAjaxController.request({action:"/admin/getteacherpupils",method:"post",vars:{userId:self.user.id},callback:function(xml){$(xml).find("pupil").each(function(){var aPupil={id:$(this).find("id").text(),username:$(this).find("username").text(),firstName:$(this).find("firstName").text(),surname:$(this).find("surname").text()}
aPupil.displayName=(aPupil.firstName)?aPupil.firstName+" "+aPupil.surname:aPupil.username;self.teacherPupils.push(aPupil);self.teacherPupilsById[aPupil.id]=aPupil;});self.generateList();}});},generateList:function(){var self=this;var iHTML='<div>';$.each(self.teacherPupils,function(){iHTML+='<div class="tlsp-admin-list-item">';iHTML+='<span class="tl-data tl-data-pupil-id">'+this.id+'</span>';iHTML+='<span class="tlsp-ali-title">'+this.displayName+'</span>';iHTML+='<span class="tlsp-ali-controls">';iHTML+='<span>View timelines</span> | <span class="tlsp-ali-remove">Remove</span>';iHTML+='</span>';iHTML+='</div>';});iHTML+='</div>';var domList=$(iHTML).get()[0];$(self.domRoot).prepend(domList);$(self.domRoot).find(".tlsp-tpl-num-accounts-taken").text(self.teacherPupils.length);$(self.domRoot).find(".tlsp-tpl-num-accounts-remaining").text(self.totalAccounts-self.teacherPupils.length);$(self.domRoot).find(".tlsp-admin-list-item").each(function(){var domItem=this;var pupilId=$(this).find(".tl-data-pupil-id").text();var domRemove=$(this).find(".tlsp-ali-remove").get()[0];var timelinesLoaded=false;$(domRemove).click(function(){self.confirmDowngradeForPupilId({pupilId:pupilId,domItem:domItem});return false;});$(domItem).click(function(){if(!timelinesLoaded){timelinesLoaded=true;self.showTimelinesForPupil({pupil:self.teacherPupilsById[pupilId],domItem:this});return false;}});});},downgradePupilWithId:function(data){var self=this;var pupilId=data.pupilId;var domConfirm=data.domConfirm;var vars={};vars["pupilId"]=pupilId;vars["userId"]=self.user.id;var action="/admin/removepupilfromteacheraccount/";$(domConfirm).find(".tlsp-ali-confirm-text").html("Removing pupil...");theAJKAjaxController.request({action:action,method:"post",vars:vars,callback:function(xml){$(domConfirm).find(".tlsp-ali-confirm-text").html("Pupil removed. Refreshing page...");window.location.reload(true);}});},confirmDowngradeForPupilId:function(data){var self=this;var domItem=data.domItem;var pupilId=data.pupilId;var domConfirm=self.createDomConfirm({removeFunc:function(){self.downgradePupilWithId({pupilId:pupilId,domConfirm:domConfirm});},cancelFunc:function(){$(domConfirm).animate({opacity:0},500,function(){$(domConfirm).remove();});}});$(domConfirm).css({opacity:0});$(domItem).append(domConfirm);$(domConfirm).animate({opacity:1},500);},createDomConfirm:function(data){var self=this;var removeFunc=data.removeFunc;var cancelFunc=data.cancelFunc;var insertHTML='<span class="tlsp-ali-confirm">';insertHTML+='<span class="tlsp-ali-confirm-text">Really remove this pupil? <span class="tlsp-ali-confirm-yes">Yes</span> | <span class="tlsp-ali-confirm-no">No</span></span>';insertHTML+='</span>';var domConfirm=$(insertHTML).get()[0];$(domConfirm).click(function(){return false});$(domConfirm).find(".tlsp-ali-confirm-yes").click(function(){removeFunc();$(this).unbind("click");return false;});$(domConfirm).find(".tlsp-ali-confirm-no").click(function(){cancelFunc();$(this).unbind("click");return false;});return domConfirm;},showTimelinesForPupil:function(data){var self=this;var pupil=data.pupil;var domItem=data.domItem;var insertHTML='<div class="tlsp-ali-confirm">';insertHTML+='<span class="tlsp-ali-confirm-text">Loading timelines: </span>';insertHTML+='</div>';var domTimelines=$(insertHTML).get()[0];$(domItem).append(domTimelines);theAJKAjaxController.request({action:"/admin/getpupiltimelines",method:"post",vars:{pupilId:pupil.id},callback:function(xml){var iHTML='<div class="tl-sp-pupil-timeline-holder">';iHTML+='<h4>'+pupil.displayName+'\'s timelines:</h4>';var tlHTML="";$(xml).find("timeline").each(function(){var tlUrlFriendlyTitle=$(this).find("urlFriendlyTitle").text();var tlTitle=$(this).find("title").text();var tlId=$(this).find("id").text();var tlUrl="/timeline/entry/"+tlId+"/"+tlUrlFriendlyTitle+"/";tlHTML+='<a href="'+tlUrl+'" target="_blank">'+tlTitle+'</a>';});tlHTML=(tlHTML)?tlHTML:"<p>This pupil has no timelines</p>";iHTML+=tlHTML;iHTML+='</div>';$(domItem).addClass("tlsp-admin-list-item-no-hover").empty().append(iHTML);}});}}
var TLSPBigCarousel=function(data){var self=this;self.domRoot=data.domRoot;self.domStage=$(self.domRoot).find(".tslp-bc-stage").get()[0];self.domItems=$(self.domRoot).find(".tlsp-b-content").get();self.domPosHolder=$(self.domRoot).find(".tlsp-bc-pos-buttons").get()[0];self.animating=false;self.numItems=self.domItems.length;self.selectedPos=0;}
TLSPBigCarousel.prototype={init:function(){var self=this;self.initItemsAndStage();self.initPosButtons();self.lightbox=new TLSPIFrameTimelineLightbox({domRoot:$("#tlsp-home-timeline-lightbox").get()[0]}).init();return self;},initItemsAndStage:function(){var self=this;self.itemWidth=$(self.domItems[0]).width();$(self.domStage).css({width:self.numItems*self.itemWidth});if(!$.browser.msie){$(self.domItems).find(".tlsp-bc-image a").click(function(){self.lightbox.showLightboxForTimeline({timeline:{embed:$(this).attr("embedUrl"),link:$(this).attr("href")}});return false;});}},initPosButtons:function(){var self=this;var iHTML='<div>';for(var counter=0;counter<self.numItems;counter++){iHTML+='<a href="#">'+(counter+1)+'</a>';}
iHTML+='</div>';$(self.domPosHolder).append(iHTML);self.domPosButtons=$(self.domPosHolder).find("a").get();$(self.domPosButtons).click(function(){var newPos=$(this).text()-1;self.animateTo({pos:newPos});return false;});$(self.domPosButtons[0]).addClass("selected");},animateTo:function(data){var self=this;var newPos=data.pos;if(!self.animating&&newPos!=self.selectedPos){self.animating=true;$(self.domPosButtons[self.selectedPos]).removeClass("selected");self.selectedPos=newPos;$(self.domPosButtons[self.selectedPos]).addClass("selected");$(self.domStage).animate({left:-self.selectedPos*self.itemWidth},750,function(){self.animating=false;});}}}
TLSPIFrameTimelineLightbox=function(data){var self=this;self.domRoot=data.domRoot;self.domContent=$(self.domRoot).find(".tlsp-tlb-content").get()[0];self.domIFrameContent=$(self.domRoot).find(".tlsp-tlb-iframe-content").get()[0];self.initialised=false;self.domCloseButton=$(self.domRoot).find(".tlsp-tlb-close").get()[0];self.domFullWindowLink=$(self.domRoot).find(".tlsp-tlb-full-window").get()[0];self.iCounter=1;}
TLSPIFrameTimelineLightbox.prototype={init:function(){var self=this;$([self.domRoot,self.domCloseButton]).click(function(){self.close();return false;});$(self.domFullWindowLink).click(function(){window.location=$(this).attr("href");return false;});return self;},showLightboxForTimeline:function(data){var self=this;if(!self.initialised){self.initIFrameJS();self.initialised=true;}
self.generateIFrameCodeForTimeline(data);$(self.domRoot).css({display:"block"});$(self.domIFrameContent).empty().append(self.domIFrame);$(self.domFullWindowLink).attr("href",data.timeline.link);self.display();},generateIFrameCodeForTimeline:function(data){var self=this;self.domIFrame=$('<iframe id="tlsp-iframe-id-'+(self.iCounter++)+'" style="border-width:0;" width="1000" height="525" src="'+data.timeline.embed+'" scrolling="no"></iframe>').get()[0];},initIFrameJS:function(){var self=this;if(window.postMessage){if(typeof window.addEventListener!="undefined"){window.addEventListener("mouseup",function(){self.informIFrameOfMouseUp();},false);}
else if(typeof window.attachEvent!="undefined"){window.attachEvent("onmouseup",function(){self.informIFrameOfMouseUp();});}}},informIFrameOfMouseUp:function(){var self=this;if(self.domIFrame&&self.domIFrame.contentWindow&&self.domIFrame.contentWindow.postMessage){self.domIFrame.contentWindow.postMessage("mouseup","*");}},display:function(){var self=this;$(self.domContent).css({opacity:0});$(self.domRoot).css({visibility:"visible",opacity:0}).animate({opacity:1},500,function(){$(self.domContent).animate({opacity:1},500);});},close:function(){var self=this;$(self.domRoot).animate({opacity:0},500,function(){$(this).css({visibility:"hidden"});$(self.domIFrameContent).empty();});$(self.domRoot).css({display:"none"});}}
var theAJKButtonPopupController,theAJKWindowResizeEvent,theAJKKeyEvent,AJKAjaxController,theTLStandardPageController,theTLSettings;if(typeof theTLMainController=="undefined"){var theTLMainController={timeline:{altFlickrImageUrl:""}}}
$(document).ready(function(){$("body").addClass("js-enabled");theAJKWindowResizeEvent=new AJKWindowResizeEvent().init();theAJKKeyEvent=new AJKKeyEvent().init();theTLSettings=new TLSettings();var pageWidth=1000;theAJKButtonPopupController=new AJKButtonPopupController({domButtons:$("#tlsp-header .tlsp-main-menu a").get(),adjustFunc:function(){var windowWidth=theAJKWindowResizeEvent.lastWindowSize.width;if(windowWidth<pageWidth){return pageWidth-windowWidth;}
else{return(pageWidth-windowWidth)/2-8;}}}).init();theAJKAjaxController=new AJKAjaxController().init();theTLStandardPageController=new TLStandardPageController().init();$(".tlsp-faq-block").each(function(){var thisBlock=this;var thisOpen=false;if($(this).hasClass("tlsp-faq-block-copy-content")){var content=$("#"+$(this).attr("rel")).find(".tlsp-faq-content").html();$(this).find(".tlsp-faq-content").html(content);}
$(this).find("h4 a").click(function(){if(thisOpen){$(thisBlock).removeClass("tlsp-faq-block-open");thisOpen=false;}
else{$(thisBlock).addClass("tlsp-faq-block-open");thisOpen=true;$(thisBlock).find(".tlsp-image").each(function(){var imageUrl=$(this).text();var insertHTML='<img src="'+imageUrl+'" alt="" />';$(this).after(insertHTML);$(this).remove();});$.scrollTo(thisBlock,500);}
return false;});});$(".tlsp-faq-block .tlsp-open-new-faq").click(function(){var faqId=$(this).attr("href").split("#")[1];$("#"+faqId).find("h4 a").click();return false;});var initialHash=window.location.hash.toString().replace("#","");if(initialHash){setTimeout(function(){$("#"+initialHash).find("h4 a").click();},500);}});